import{L as A,M as g,_ as C,g as $,a as b,b as n,c as l,d as s,Q as E,e as v,w as _,p as L,u as R,r as c,o as V,G as h,i as P}from"./index-29fa3e11.js";const M=A("usuarios",{state:()=>({apiURL:"https://sgip-api-0fe230af7558.herokuapp.com/api/v1/usuarios/",message:"",error:"",data:[]}),actions:{async get(){this.error="";try{const e=await g.get(`${this.apiURL}`);return this.data=e.data.data,this.message=e.data.message,e}catch(e){return this.error=e.response.data.message||e.message,e}},async changePassword(e){this.error="";try{const a=await g.put(`${this.apiURL}contrasena`,e);return this.data=a.data.data,this.message=a.data.message,a}catch(a){return this.error=a.response.data.message||a.message,a}},async datos(e){this.error="";try{const a=await g.get(`${this.apiURL}datos?nombre=${e.nombre}&apellidos=${e.apellidos}`);return this.data=a.data.data,this.message=a.data.message,a}catch(a){return this.error=a.response.data.message||a.message,a}}}}),S=$({name:"opciones",setup(){const e=M(),a=P();R();const t=c({contrasenaActual:"",contrasenaNueva:"",confirmarNueva:""}),d=c(!1),m=c(!1),p=c(!1),r=c(!1),i=c(!1),f=c(!1),o=c(!1),y=()=>{console.log("pass changed"),t.value.contrasenaNueva!==""&&t.value.contrasenaNueva!==null&&t.value.contrasenaNueva!==void 0?(d.value=/[A-Z]/.test(t.value.contrasenaNueva),m.value=/[a-z]/.test(t.value.contrasenaNueva),p.value=/[0-9]/.test(t.value.contrasenaNueva),r.value=/.*[!#$%&*+-.?@_]/.test(t.value.contrasenaNueva),i.value=/^.{8,20}$/.test(t.value.contrasenaNueva),f.value=d.value&&m.value&&p.value&&r.value&&i.value,o.value=f.value&&t.value.contrasenaNueva===t.value.confirmarNueva&&t.value.contrasenaActual!==""&&t.value.contrasenaActual!==null&&t.value.contrasenaActual!==void 0,o.value?document.getElementById("subPass").classList.remove("p-disabled"):document.getElementById("subPass").classList.add("p-disabled")):(d.value=!1,m.value=!1,p.value=!1,r.value=!1,i.value=!1)},k=async()=>{if(o.value){let u=!1;a.showLoading("Actualizando contraseña"),setTimeout(()=>{u||(a.closeLoading(),a.showErrorAlert("Error","Ocurrió un error inesperado"))},5e3);let N={contrasenaActual:t.value.contrasenaActual,contrasenaNueva:t.value.contrasenaNueva};await e.changePassword(N).then(()=>{a.closeLoading(),u=!0,a.showSuccessAlert("Éxito","Contraseña actualizada correctamente")}).catch(w=>{w.code==="ERR_NETWORK"?a.showErrorAlert("Error","No se pudo conectar con el servidor"):a.showErrorAlert("Error","Ocurrió un error inesperado"),u=!0})}};return V(()=>{document.querySelectorAll('input[type="password"]').forEach(u=>{u.setAttribute("maxlength",20),u.classList.add("w-100")})}),{data:t,tieneMayuscula:d,tieneMinuscula:m,tieneNumero:p,tieneSimbolo:r,passChange:y,tamanoOk:i,cambiarContrasena:k}}}),x={class:"container-lg pt-4 my-3"},B={class:"card shadow-5 border-round-2xl overflow-hidden mx-auto",style:{"max-width":"500px"}},K=s("div",{class:"d-flex card-header py-0 pe-0"},[s("span",{class:"flex text-center"},[s("i",{class:"bi bi-key-fill fw-bold h1 my-0"}),s("span",{class:"fw-bold h4 align-self-center ms-3 my-0"}," Cambiar contraseña ")])],-1),O={class:"card-body table-responsive"},U={class:"grid mb-2"},z={class:"col-12 flex"},T=s("label",null,"Contraseña actual",-1),Z=s("label",null,"Escribe una nueva contraseña",-1),q=s("h6",null,"Seguridad de la contraseña",-1),D=s("p",{class:"mt-2"},"La contraseña debe tener:",-1),I={class:"pl-2 ml-2 mt-0 list-none",style:{"line-height":"1.5"}},G={key:0,class:"pi pi-check-circle text-success"},Q={key:1,class:"pi pi-circle"},W={key:0,class:"pi pi-check-circle text-success"},Y={key:1,class:"pi pi-circle"},j={key:0,class:"pi pi-check-circle text-success"},F={key:1,class:"pi pi-circle"},H={key:0,class:"pi pi-check-circle text-success"},J={key:1,class:"pi pi-circle"},X={key:0,class:"pi pi-check-circle text-success"},ee={key:1,class:"pi pi-circle"},ae=s("label",null,"Repite tu nueva contraseña",-1),se=s("div",{class:"col-12 lg:col-6"},null,-1);function te(e,a,t,d,m,p){const r=b("Password"),i=b("Divider"),f=b("Button");return n(),l("div",x,[s("div",B,[K,s("div",O,[s("div",U,[s("div",z,[s("form",{onSubmit:a[3]||(a[3]=E((...o)=>e.cambiarContrasena&&e.cambiarContrasena(...o),["prevent"]))},[T,v(r,{modelValue:e.data.contrasenaActual,"onUpdate:modelValue":a[0]||(a[0]=o=>e.data.contrasenaActual=o),class:"w-100 mb-3",feedback:!1,toggleMask:"",onKeyup:e.passChange},null,8,["modelValue","onKeyup"]),Z,v(r,{modelValue:e.data.contrasenaNueva,"onUpdate:modelValue":a[1]||(a[1]=o=>e.data.contrasenaNueva=o),toggleMask:"",class:"w-100 mb-3",onKeyup:e.passChange,mediumRegex:"^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[!#$%&*+-.?@_]).{6,20}$",strongRegex:"^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[!#$%&*+-.?@_]).{8,20}$",weakLabel:"No cumple con los requisitos mínimos de seguridad",mediumLabel:"Ya casi tienes una contraseña segura"},{header:_(()=>[q]),footer:_(()=>[v(i),D,s("ul",I,[s("li",null,[e.tieneMayuscula?(n(),l("i",G)):(n(),l("i",Q)),h(" Por lo menos una mayúscula ")]),s("li",null,[e.tieneMinuscula?(n(),l("i",W)):(n(),l("i",Y)),h(" Por lo menos una minúscula ")]),s("li",null,[e.tieneNumero?(n(),l("i",j)):(n(),l("i",F)),h(" Por lo menos un número ")]),s("li",null,[e.tieneSimbolo?(n(),l("i",H)):(n(),l("i",J)),h(" Por lo menos un símbolo (!#$%&*+-.?@_) ")]),s("li",null,[e.tamanoOk?(n(),l("i",X)):(n(),l("i",ee)),h(" Entre 8 y 20 caracteres ")])])]),_:1},8,["modelValue","onKeyup","mediumRegex","strongRegex"]),ae,v(r,{modelValue:e.data.confirmarNueva,"onUpdate:modelValue":a[2]||(a[2]=o=>e.data.confirmarNueva=o),class:L([[{"p-invalid":e.data.contrasenaNueva!==e.data.confirmarNueva}],"w-100 mb-3"]),feedback:!1,toggleMask:"",onKeyup:e.passChange},null,8,["modelValue","class","onKeyup"]),v(f,{type:"submit",id:"subPass",label:"Cambiar contraseña",icon:"pi pi-check",class:"float-end p-disabled",raised:""})],32)]),se])])])])}const ne=C(S,[["render",te]]);export{ne as default};
