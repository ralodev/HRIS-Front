import{_ as T,P as w,D as h,g as R,a as _,b as q,c as B,d as n,e as u,h as C,r as v,I as y,u as N,o as D,s as S,n as U,i as I}from"./index-66b45988.js";import{u as V}from"./adminStore-4aa09d34.js";w.use(h,h,h,h);const K=R({name:"TablaEmpleados",components:{DataTable:w},setup(){const a=v("");y.get("email");let i;const g=v(),p=V(),t=I(),m=N(),b=v([]),c={responsive:!0,autoWidth:!0,dom:"trip",paging:!0,pagingType:"numbers",language:S,pageLength:10,order:[[0,"asc"]],initComplete:function(){this.on("draw.dt",function(){U(()=>{L(),i.responsive.recalc()})})}},E=[{data:null,title:"Nombre",class:"all",width:"20%",render:function(e){let o;return e.estado=="ACTIVO"?o="<span class='float-end p-tag p-component p-tag-success' title='Este usuario está habilitado' style='cursor: help !important;'>H<span class='d-lg-block d-none'>abilitado</span></span>":e.estado=="BLOQUEADO"?o="<span class='float-end p-tag p-component p-tag-danger' title='Este usuario se encuentra bloqueado' style='cursor: help !important;'>B<span class='d-lg-block d-none'>loqueado</span></span>":o="<span class='float-end p-tag p-component p-tag-warning' title='Este usuario no ha confirmado su correo electrónico' style='cursor: help !important;'>P<span class='d-lg-block d-none'>endiente</span>",e.nombre+" "+e.apellidos+" "+o}},{data:"rol",title:"Rol",width:"10%",class:"min-tablet-l",render:function(e){let o=e=="ROLE_ADMIN"?1:e=="ROLE_EMPLEADO_HR"?2:e=="ROLE_PLANEACION"?3:e=="ROLE_ASISTENTE_HR"?4:5,l=e.replaceAll("_"," ").replaceAll("ROLE","");return"<span class='d-none'>"+o+"</span>"+l}},{data:"email",title:"Correo electrónico",class:"min-tablet-l no-wrap text-nowrap email-col",width:"10%"},{data:null,class:"text-nowrap  acciones justify-content-center all ",width:"10%",title:"Acciones",orderable:!1,wrap:!0,render:function(e){let o="<a title='Ver empleado' name='"+e.id+"' class='details-btn me-1 px-3 p-button-sm p-button p-component p-button-icon-only p-button-primary p-button-raised text-decoration-none'><i class='pi pi-user-edit'></i></a> ";return e.estado=="BLOQUEADO"?o+="<a title='Desbloquear' name='"+e.id+"' class='unlock-btn px-3 p-button-sm p-button p-component p-button-icon-only p-button-success bg-green-600 p-button-raised text-decoration-none'><i class='pi pi-lock-open'></i></a>":o+="<a title='Bloquear' name='"+e.id+"' class='lock-btn px-3 p-button-sm p-button p-component p-button-icon-only p-button-danger p-button-raised text-decoration-none'><i class='pi pi-lock'></i></a>",o}},{data:"estado",title:"Estado",class:"never"}],d=async()=>{var e=!1;t.showLoading("Cargando datos"),setTimeout(()=>{e||(t.closeLoading(),t.showErrorAlert("Error","Ocurrió un error inesperado"))},5e3),await p.getUsuarios().then(o=>{let l=o.data;l=l.filter(r=>(r.locked?r.estado="BLOQUEADO":r.enabled?r.estado="ACTIVO":r.estado="INACTIVO",r.email!=="18161160@itoaxaca.edu.mx")),b.value=l,t.closeLoading(),e=!0}).catch(o=>{o.code==="ERR_NETWORK"?t.showErrorAlert("Error","No se pudo conectar con el servidor"):t.showErrorAlert("Error","Ocurrió un error inesperado"),e=!0})},L=()=>{const e=document.querySelectorAll(".details-btn"),o=document.querySelectorAll(".lock-btn"),l=document.querySelectorAll(".unlock-btn"),r=document.querySelectorAll(".email-col"),O=y.get("email");e.forEach(s=>{s.parentElement.classList.add("flex"),s.addEventListener("click",()=>{m.push({name:"usuarios_editar",params:{id:s.attributes.name.value}})})}),o.forEach(s=>{s.parentElement.classList.add("flex"),s.addEventListener("click",()=>{x(s.attributes.name.value)})}),l.forEach(s=>{s.parentElement.classList.add("flex"),s.addEventListener("click",()=>{k(s.attributes.name.value)})}),r.forEach(s=>{if(s.innerText==O){s.closest("tr").children[3].title="No puedes bloquear tu propio usuario";let f=s.closest("tr").children[3].children[0];f.nextElementSibling.classList.add("p-disabled"),f.nextElementSibling.classList.add("p-button-secondary"),f.nextElementSibling.classList.remove("p-button-danger")}})},A=()=>{i.search(a.value).draw()};D(()=>{d(),i=g.value.dt});const x=e=>{t.showLoading("Bloqueando usuario"),setTimeout(()=>{t.closeLoading()},5e3),p.bloquearUsuario(e).then(()=>{t.closeLoading(),t.showSuccessAlert("Éxito","Usuario bloqueado"),d()}).catch(o=>{t.closeLoading(),o.code==="ERR_NETWORK"?t.showErrorAlert("Error","No se pudo conectar con el servidor"):t.showErrorAlert("Error","Ocurrió un error inesperado")})},k=e=>{t.showLoading("Desbloqueando usuario"),p.desbloquearUsuario(e).then(()=>{t.closeLoading(),t.showSuccessAlert("Éxito","Usuario desbloqueado"),d()}).catch(o=>{o.code==="ERR_NETWORK"?t.showErrorAlert("Error","No se pudo conectar con el servidor"):t.showErrorAlert("Error","Ocurrió un error inesperado")})};return{columns:E,data:b,options:c,registrar:()=>{m.push({name:"usuarios_registrar"})},historial:()=>{m.push({name:"usuarios_historial"})},search:A,searchText:a,table:g}}}),H={class:"container-lg pt-4 my-3"},P={class:"card shadow-5 border-round-2xl overflow-hidden"},W=n("div",{class:"d-flex card-header py-0 pe-0"},[n("span",{class:"flex text-center"},[n("i",{class:"bi bi-person-vcard-fill fw-bold h1 my-0"}),n("span",{class:"fw-bold h4 align-self-center ms-3 my-0"}," Usuarios registrados ")])],-1),$={class:"card-body table-responsive"},M={class:"grid mb-2"},Q={class:"col-12 lg:col-6 md:col-6"},j={class:"p-inputgroup"},z={class:"col-12 lg:col-6 md:col-6"};function F(a,i,g,p,t,m){const b=_("InputText"),c=_("Button"),E=_("DataTable");return q(),B("div",H,[n("div",P,[W,n("div",$,[n("div",M,[n("div",Q,[n("div",j,[u(b,{placeholder:"Buscar usuario",id:"searchInput",onKeyup:C(a.search,["enter"]),modelValue:a.searchText,"onUpdate:modelValue":i[0]||(i[0]=d=>a.searchText=d),type:"search",autocomplete:"none"},null,8,["onKeyup","modelValue"]),u(c,{icon:"pi pi-search",severity:"primary",onClick:a.search},null,8,["onClick"])])]),n("div",z,[u(c,{type:"button",label:"Registrar usuario",icon:"pi pi-user-plus",onClick:a.registrar,class:"float-end",raised:""},null,8,["onClick"]),u(c,{type:"button",label:"Historial",icon:"pi pi-history",onClick:a.historial,class:"float-end me-2",severity:"secondary",raised:""},null,8,["onClick"])])]),u(E,{columns:a.columns,data:a.data,class:"table-responsive text-nowrap hover row-border border order-column",width:"100%",options:a.options,ref:"table"},null,8,["columns","data","options"])])])])}const X=T(K,[["render",F]]);export{X as default};
