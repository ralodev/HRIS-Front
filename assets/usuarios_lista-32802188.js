import{_ as T,P as y,D as m,g as R,a as f,b as q,c as B,d as n,e as u,h as C,r as _,I as v,u as N,o as D,s as S,n as U,i as I}from"./index-8df1458c.js";import{u as V}from"./adminStore-956f9805.js";y.use(m,m,m,m);const K=R({name:"TablaEmpleados",components:{DataTable:y},setup(){const a=_("");v.get("email");let l;const h=_(),i=V(),s=I(),p=N(),r=_([]),c={responsive:!0,autoWidth:!0,dom:"trip",paging:!0,pagingType:"numbers",language:S,pageLength:10,order:[[0,"asc"]],initComplete:function(){this.on("draw.dt",function(){U(()=>{w(),l.responsive.recalc()})})}},b=[{data:null,title:"Nombre",class:"all",width:"20%",render:function(o){let e;return o.estado=="ACTIVO"?e="<span class='float-end p-tag p-component p-tag-success' title='Este usuario está habilitado' style='cursor: help !important;'>H<span class='d-lg-block d-none'>abilitado</span></span>":o.estado=="BLOQUEADO"?e="<span class='float-end p-tag p-component p-tag-danger' title='Este usuario se encuentra bloqueado' style='cursor: help !important;'>B<span class='d-lg-block d-none'>loqueado</span></span>":e="<span class='float-end p-tag p-component p-tag-warning' title='Este usuario no ha confirmado su correo electrónico' style='cursor: help !important;'>P<span class='d-lg-block d-none'>endiente</span>",o.nombre+" "+o.apellidos+" "+e}},{data:"rol",title:"Rol",width:"10%",class:"min-tablet-l",render:function(o){let e=o=="ROLE_ADMIN"?1:o=="ROLE_EMPLEADO_HR"?2:o=="ROLE_PLANEACION"?3:o=="ROLE_ASISTENTE_HR"?4:5,g=o.replaceAll("_"," ").replaceAll("ROLE","");return"<span class='d-none'>"+e+"</span>"+g}},{data:"email",title:"Correo electrónico",class:"min-tablet-l no-wrap text-nowrap email-col",width:"10%"},{data:null,class:"text-nowrap  acciones justify-content-center all ",width:"10%",title:"Acciones",orderable:!1,wrap:!0,render:function(o){let e="<a title='Ver empleado' name='"+o.id+"' class='details-btn me-1 px-3 p-button-sm p-button p-component p-button-icon-only p-button-primary p-button-raised text-decoration-none'><i class='pi pi-user-edit'></i></a> ";return o.estado=="BLOQUEADO"?e+="<a title='Desbloquear' name='"+o.id+"' class='unlock-btn px-3 p-button-sm p-button p-component p-button-icon-only p-button-success bg-green-600 p-button-raised text-decoration-none'><i class='pi pi-lock-open'></i></a>":e+="<a title='Bloquear' name='"+o.id+"' class='lock-btn px-3 p-button-sm p-button p-component p-button-icon-only p-button-danger p-button-raised text-decoration-none'><i class='pi pi-lock'></i></a>",e}},{data:"estado",title:"Estado",class:"never"}],d=async()=>{var o=!1;s.showLoading("Cargando datos"),setTimeout(()=>{o||(s.closeLoading(),s.showErrorAlert("Error","Ocurrió un error inesperado"))},5e3),await i.getUsuarios().then(()=>{r.value=i.data,r.value.forEach(e=>{e.email=="18161160@itoaxaca.edu.mx"&&r.value.splice(r.value.indexOf(e),1),e.locked==!0?e.estado="BLOQUEADO":e.enabled==!1?e.estado="INACTIVO":e.estado="ACTIVO"}),s.closeLoading(),o=!0}).catch(e=>{e.code==="ERR_NETWORK"?s.showErrorAlert("Error","No se pudo conectar con el servidor"):s.showErrorAlert("Error","Ocurrió un error inesperado"),o=!0})},w=()=>{const o=document.querySelectorAll(".details-btn"),e=document.querySelectorAll(".lock-btn"),g=document.querySelectorAll(".unlock-btn"),k=document.querySelectorAll(".email-col"),O=v.get("email");o.forEach(t=>{t.parentElement.classList.add("flex"),t.addEventListener("click",()=>{p.push({name:"usuarios_editar",params:{id:t.attributes.name.value}})})}),e.forEach(t=>{t.parentElement.classList.add("flex"),t.addEventListener("click",()=>{A(t.attributes.name.value)})}),g.forEach(t=>{t.parentElement.classList.add("flex"),t.addEventListener("click",()=>{x(t.attributes.name.value)})}),k.forEach(t=>{if(t.innerText==O){t.closest("tr").children[3].title="No puedes bloquear tu propio usuario";let E=t.closest("tr").children[3].children[0];E.nextElementSibling.classList.add("p-disabled"),E.nextElementSibling.classList.add("p-button-secondary"),E.nextElementSibling.classList.remove("p-button-danger")}})},L=()=>{l.search(a.value).draw()};D(()=>{d(),l=h.value.dt});const A=o=>{s.showLoading("Bloqueando usuario"),setTimeout(()=>{s.closeLoading()},5e3),i.bloquearUsuario(o).then(()=>{s.closeLoading(),s.showSuccessAlert("Éxito","Usuario bloqueado"),d()}).catch(e=>{s.closeLoading(),e.code==="ERR_NETWORK"?s.showErrorAlert("Error","No se pudo conectar con el servidor"):s.showErrorAlert("Error","Ocurrió un error inesperado")})},x=o=>{s.showLoading("Desbloqueando usuario"),i.desbloquearUsuario(o).then(()=>{s.closeLoading(),s.showSuccessAlert("Éxito","Usuario desbloqueado"),d()}).catch(e=>{e.code==="ERR_NETWORK"?s.showErrorAlert("Error","No se pudo conectar con el servidor"):s.showErrorAlert("Error","Ocurrió un error inesperado")})};return{columns:b,data:r,options:c,registrar:()=>{p.push({name:"usuarios_registrar"})},historial:()=>{p.push({name:"usuarios_historial"})},search:L,searchText:a,table:h}}}),H={class:"container-lg pt-4 my-3"},P={class:"card shadow-5 border-round-2xl overflow-hidden"},W=n("div",{class:"d-flex card-header py-0 pe-0"},[n("span",{class:"flex text-center"},[n("i",{class:"bi bi-person-vcard-fill fw-bold h1 my-0"}),n("span",{class:"fw-bold h4 align-self-center ms-3 my-0"}," Usuarios registrados ")])],-1),$={class:"card-body table-responsive"},M={class:"grid mb-2"},Q={class:"col-12 lg:col-6 md:col-6"},j={class:"p-inputgroup"},z={class:"col-12 lg:col-6 md:col-6"};function F(a,l,h,i,s,p){const r=f("InputText"),c=f("Button"),b=f("DataTable");return q(),B("div",H,[n("div",P,[W,n("div",$,[n("div",M,[n("div",Q,[n("div",j,[u(r,{placeholder:"Buscar usuario",id:"searchInput",onKeyup:C(a.search,["enter"]),modelValue:a.searchText,"onUpdate:modelValue":l[0]||(l[0]=d=>a.searchText=d),type:"search",autocomplete:"none"},null,8,["onKeyup","modelValue"]),u(c,{icon:"pi pi-search",severity:"primary",onClick:a.search},null,8,["onClick"])])]),n("div",z,[u(c,{type:"button",label:"Registrar usuario",icon:"pi pi-user-plus",onClick:a.registrar,class:"float-end",raised:""},null,8,["onClick"]),u(c,{type:"button",label:"Historial",icon:"pi pi-history",onClick:a.historial,class:"float-end me-2",severity:"secondary",raised:""},null,8,["onClick"])])]),u(b,{columns:a.columns,data:a.data,class:"table-responsive text-nowrap hover row-border border order-column",width:"100%",options:a.options,ref:"table"},null,8,["columns","data","options"])])])])}const X=T(K,[["render",F]]);export{X as default};
