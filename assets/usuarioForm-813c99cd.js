import{u as T}from"./adminStore-460c7ebb.js";import{g as U,_ as M,r as m,k as P,u as G,o as H,n as I,l as j,a as S,m as $,b as l,c as t,d as a,t as k,e as f,v as V,j as _,q as n,p as C,i as F,S as D,G as g,f as R}from"./index-818cca80.js";const J=U({name:"UsuarioForm",watch:{},props:{isEdit:{type:Boolean,default:!1}},setup(e){const r=m(e.isEdit),O=P(),p=G(),b=T(),y=m(!1),o=m(!1),i=m({}),s=m({}),v=m(null),c=m(!1),{showToast:h,showSuccessAlert:z,showConfirmAlert:A,showErrorAlert:x,showLoading:N,closeLoading:B}=F(),q=[{nombre:"ADMINISTRADOR",value:"ROLE_ADMIN"},{nombre:"EMPLEADO DE RECURSOS HUMANOS",value:"ROLE_EMPLEADO_HR"},{nombre:"ASISTENTE DE RECURSOS HUMANOS",value:"ROLE_ASISTENTE_HR"},{nombre:"EMPLEADO GENERAL",value:"ROLE_EMPLEADO"}];H(()=>{r.value&&(N(),v.value=O.params.id,b.getUsuario(v.value).then(()=>{s.value=b.data,console.log(s.value),I(()=>{y.value=!0,w(),B()})}))});const w=()=>{if(y.value=!0,o.value=!0,s.value.nombre==null||s.value.nombre==null||s.value.nombre==""?(i.value.nombre="El nombre es obligatorio",o.value=!1):i.value.nombre="",s.value.apellidos==null||s.value.apellidos==null||s.value.apellidos==""?(i.value.apellidos="Los apellidos son obligatorios",o.value=!1):i.value.apellidos="",s.value.email==null||s.value.email==null||s.value.email==""?(i.value.email="El correo electrónico es obligatorio",o.value=!1):s.value.email.includes("@")?i.value.email="":(i.value.email="El correo electrónico debe ser válido",o.value=!1),s.value.rol==null||s.value.rol==null||s.value.rol==""?(i.value.rol="El rol es obligatorio",o.value=!1):i.value.rol="",!o.value){h("error","Verifique los campos marcados en rojo");return}};return{data:s,validate:w,submit:()=>{w();let d={...s.value};if(r.value){var E=s.value.email;A("¿Estás seguro?","Se actualizarán los datos del usuario","warning","Sí, actualizar","No, cancelar").then(L=>{L?b.editarUsuario(E,d).then(u=>{console.log(u),u.status==200?z("¡Éxito!","El usuario se ha actualizado correctamente","success","Aceptar").then(()=>{p.push({name:"usuarios"})}):x("Error",u.response.data.mensaje,"error","Aceptar")}).catch(u=>{h("error","Ocurrió un error al actualizar el usuario")}):h("info","No se actualizaron los datos")})}else A("¿Estás seguro?","Se registrarán los datos del usuario","warning","Sí, registrar","No, cancelar").then(L=>{L?b.registrarUsuario(d).then(u=>{u.status==200?z("¡Registro exitoso!","El usuario recibirá un correo en unos minutos, revise su bandeja de entrada y su bandeja de spam","success","Aceptar").then(()=>{p.push({name:"usuarios"})}):x("Error",u.response.data.mensaje,"error","Aceptar")}).catch(u=>{h("error","Ocurrió un error al registrar el usuario")}):h("info","No se registraron los datos")})},cancelar:()=>{A("¿Deseas cancelar?","Los cambios no guardados se perderán","question","Sí, cancelar","No, regresar").then(d=>{d&&p.push({name:"usuarios"})})},error:i,validated:y,isEdit:r,eliminar:()=>{D.fire({title:"Se requiere confirmación",text:"Esta acción eliminará al usuario de forma permanente y no se puede revertir, puedes bloquear al usuario en su lugar y reactivarlo cuando lo desees.",icon:"warning",iconColor:"#dc3545",input:"checkbox",inputValue:0,inputPlaceholder:"Entiendo, quiero continuar",confirmButtonText:'Continuar <i class="bi bi-shield-exclamation"></i>',confirmButtonColor:"#dc3545",cancelButtonText:"Cancelar</i>",showCancelButton:!0,inputValidator:d=>!d&&"Debes confirmar que entiendes las consecuencias de esta acción"}).then(d=>{d.value&&(console.log(s.value.id),b.eliminarUsuario(s.value.id).then(E=>{E==200?D.fire({icon:"success",title:"¡Éxito!",text:"El usuario ha sido eliminado de forma permanente"}).then(()=>{p.push({name:"usuarios"})}):x("Error","Ocurrió un error al eliminar el usuario","error","Aceptar")}).catch(E=>{h("error","Ocurrió un error al eliminar el usuario")}))})},roles:q,isLocked:c,goBack:()=>p.go(-1),verHistorial:()=>p.push({name:"usuarios_historial",params:{id:s.value.id}})}},components:{InputText:j}}),K={class:"container-lg pt-4 my-3"},Q={class:"card shadow-5 border-round-2xl overflow-hidden"},W={class:"d-flex relative card-header py-0 pe-0"},X={class:"flex text-center"},Y={key:0,class:"bi bi-person-fill-gear fw-bold h1 my-0"},Z={key:1,class:"bi bi-person-fill-add fw-bold h1 my-0"},ee={class:"fw-bold h4 align-self-center ms-3 my-0"},se={id:"form"},ae={class:"card-body"},oe={class:"grid"},le={class:"col-12"},ie={class:"col-12 md:col-offset-3 md:col-6"},re=a("label",{for:"curp",class:"form-label"},[g("Correo electrónico"),a("b",{class:"p-error"},"*")],-1),ne={key:0,class:"p-error"},te={class:"col-12 md:col-offset-3 md:col-6"},ce=a("label",{for:"nombre",class:"form-label"},[g("Nombre(s)"),a("b",{class:"p-error"},"*")],-1),de={key:0,class:"p-error"},ue={class:"col-12 md:col-offset-3 md:col-6"},pe=a("label",{for:"rfc",class:"form-label"},[g("Apellidos"),a("b",{class:"p-error"},"*")],-1),me={key:0,class:"p-error"},fe={class:"col-12 md:col-offset-3 md:col-6"},be=a("label",{for:"genero",class:"form-label"},[g("Rol"),a("b",{class:"text-danger"},"*")],-1),ve={key:0,class:"p-error"},he={key:0,class:"col-12"},ke=R('<strong class="text-color">Permisos del rol:</strong><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de empleados (incluyendo historial)</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de plazas</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de departamentos</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Realizar consultas avanzadas y exportar los resultados</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Generar y exportar reportes</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Acceder al dashboard</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Registrar, eliminar, bloquear y desbloquear usuarios</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Generar y descargar respaldos de la Base de datos</span>',9),ge=[ke],ye={key:1,class:"col-12"},Ee=R('<strong class="text-color">Permisos del rol:</strong><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de empleados (incluyendo historial)</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de plazas</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de departamentos</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Realizar consultas avanzadas y exportar los resultados</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Generar y exportar reportes</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Acceder al dashboard</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Registrar, eliminar, bloquear y desbloquear usuarios</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Generar y descargar respaldos de la Base de datos</span>',9),_e=[Ee],Ce={key:2,class:"col-12"},Re=R('<strong class="text-color">Permisos del rol:</strong><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de empleados (incluyendo historial)</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de plazas</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de departamentos</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Realizar consultas avanzadas y exportar los resultados</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Generar y exportar reportes</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Acceder al dashboard</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Registrar, eliminar, bloquear y desbloquear usuarios</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Generar y descargar respaldos de la Base de datos</span>',9),Ae=[Re],xe={key:3,class:"col-12"},we=R('<strong class="text-color">Permisos del rol:</strong><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar su propia información (inf. personal, plazas y expediente)</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Consultar y modificar información de plazas</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Consultar y modificar información de departamentos</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Realizar consultas avanzadas y exportar los resultados</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Generar y exportar reportes</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Acceder al dashboard</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Registrar, eliminar, bloquear y desbloquear usuarios</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Generar y descargar respaldos de la Base de datos</span>',9),Le=[we],Se=a("small",null,[a("b",{class:"text-danger"},"*"),g(" Campos obligatorios")],-1),Ve={class:"card-footer d-flex"};function Oe(e,r,O,p,b,y){const o=S("Button"),i=S("InputText"),s=S("Dropdown"),v=$("tooltip");return l(),t("div",K,[a("div",Q,[a("div",W,[a("span",X,[e.isEdit?(l(),t("i",Y)):(l(),t("i",Z)),a("span",ee,k(e.isEdit?" Editar":"Registrar")+" Usuario ",1)]),f(o,{icon:"pi pi-times",severity:"danger",size:"small",onClick:e.goBack,class:"ms-auto border-noround float-end hover:bg-red-500 hover:text-white",text:"",style:{height:"48px"}},null,8,["onClick"])]),a("form",se,[a("div",ae,[a("div",oe,[a("div",le,[e.isEdit?V((l(),_(o,{key:0,icon:"bi bi-bootstrap-reboot",class:"float-end border-none",onClick:e.verHistorial,label:"Restablecer",severity:"secondary"},null,8,["onClick"])),[[v,"Restablecer contraseña",void 0,{top:!0}]]):n("",!0),e.isEdit?V((l(),_(o,{key:1,icon:"pi pi-book",class:"float-end border-none me-2",onClick:e.verHistorial,label:"Actividad",severity:"secondary"},null,8,["onClick"])),[[v,"Ver historial",void 0,{top:!0}]]):n("",!0),e.isEdit?V((l(),_(o,{key:2,icon:e.isLocked?"pi-lock-open":"pi pi-lock",class:"float-end border-none me-2",onClick:e.verHistorial,label:e.isLocked.value?"Desbloquear":"Bloquear",severity:e.isLocked.value?"primary":"warning"},null,8,["icon","onClick","label","severity"])),[[v,"Ver historial",void 0,{top:!0}]]):n("",!0)]),a("div",ie,[re,f(i,{modelValue:e.data.email,"onUpdate:modelValue":r[0]||(r[0]=c=>e.data.email=c),autocomplete:"none",placeholder:"Direccion de correo electrónico",class:C(["w-full",{"p-invalid":e.error.email&&e.validated}])},null,8,["modelValue","class"]),e.validated?(l(),t("small",ne,k(e.error.email||""),1)):n("",!0)]),a("div",te,[ce,f(i,{modelValue:e.data.nombre,"onUpdate:modelValue":r[1]||(r[1]=c=>e.data.nombre=c),placeholder:"Nombre de la persona, ej: Juan",class:C(["w-full",{"p-invalid":e.error.nombre&&e.validated}]),id:"nombre"},null,8,["modelValue","class"]),e.validated?(l(),t("small",de,k(e.error.nombre||""),1)):n("",!0)]),a("div",ue,[pe,f(i,{modelValue:e.data.apellidos,"onUpdate:modelValue":r[2]||(r[2]=c=>e.data.apellidos=c),placeholder:"Apellidos de la persona, ej: Perez Lopez",class:C(["w-full",{"p-invalid":e.error.apellidos&&e.validated}])},null,8,["modelValue","class"]),e.validated?(l(),t("small",me,k(e.error.apellidos||""),1)):n("",!0)]),a("div",fe,[be,f(s,{modelValue:e.data.rol,"onUpdate:modelValue":r[3]||(r[3]=c=>e.data.rol=c),options:e.roles,optionLabel:"nombre",optionValue:"value",placeholder:"Elija el rol cuidadosamente",class:C(["w-full",{"p-invalid":e.error.rol&&e.validated}]),showClear:""},null,8,["modelValue","options","class"]),e.validated?(l(),t("small",ve,k(e.error.rol||""),1)):n("",!0)]),e.data.rol=="ROLE_ADMIN"?(l(),t("div",he,ge)):n("",!0),e.data.rol=="ROLE_EMPLEADO_HR"?(l(),t("div",ye,_e)):n("",!0),e.data.rol=="ROLE_ASISTENTE_HR"?(l(),t("div",Ce,Ae)):n("",!0),e.data.rol=="ROLE_EMPLEADO"?(l(),t("div",xe,Le)):n("",!0)]),Se]),a("div",Ve,[e.isEdit?(l(),_(o,{key:0,icon:"pi pi-trash",class:"me-2",label:"Eliminar",onClick:e.eliminar,severity:"danger"},null,8,["onClick"])):n("",!0),f(o,{icon:"pi pi-check",id:"submitButton",class:"me-2 ms-auto",label:"Guardar",onClick:e.submit},null,8,["onClick"]),f(o,{icon:"pi pi-times",class:"ms-2 float-end",severity:"secondary",label:"Cancelar",onClick:e.cancelar},null,8,["onClick"])])])])])}const Te=M(J,[["render",Oe]]);export{Te as E};
