import{g as oe,_ as ae,r as m,k as le,u as se,o as re,n as ne,l as te,a as I,m as ie,b as t,c as i,d as o,t as p,e as d,p as v,q as c,v as j,j as D,x as X,y as de,z as ce,A as ue,B as me,C as pe,E as ve,i as _,S as x,G as f}from"./index-11dec27b.js";import{u as fe}from"./empleadoStore-115317c2.js";import{u as he}from"./departamentoStore-d5241201.js";const be=oe({name:"EmpleadoForm",watch:{},props:{isEdit:{type:Boolean,default:!1}},setup(e){const a=m(e.isEdit),M=m(de),U=m(ce),R=m(ue),F=m(me),g=m(pe),h=m(ve),C=le(),b=se(),y=fe(),w=he(),l=m([]),A=m(!1),n=m(!1),r=m({}),s=m({}),P=m(null),S=_(),{showToast:V,showSuccessAlert:z,showConfirmAlert:k,showErrorAlert:q,showLoading:So,closeLoading:ee}=_();re(()=>{S.showLoading("Cargando datos..."),w.getDepartamentos().then(()=>{l.value=w.data,l.value.forEach(u=>{delete u.empleados}),a.value?(P.value=C.params.id,y.getEmpleado(P.value).then(()=>{s.value=y.data,ne(()=>{S.closeLoading(),A.value=!0,L(),ee()})})):S.closeLoading()})});function O(){s.value.nombre?r.value.nombre="":(r.value.nombre="El nombre es obligatorio",n.value=!1)}function $(){s.value.rfc?/^[A-Z]{4}\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])[A-Z\d]{3}$/.test(s.value.rfc)?(r.value.rfc="",T()):(r.value.rfc="El RFC no tiene un formato válido",n.value=!1,document.getElementById("rfc").focus()):(r.value.rfc="El RFC es obligatorio",n.value=!1,document.getElementById("rfc").focus())}function T(){s.value.curp?/^[A-Z]{4}\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])[HM](AS|BC|BS|CC|CH|CL|CM|CS|DF|DG|GR|GT|HG|JC|MC|MN|MS|NE|NL|NT|OC|PL|QT|QR|SP|SL|SR|TC|TL|TS|VZ|YN|ZS)[A-Z]{3}[0-9A-Z]{2}$/.test(s.value.curp)?s.value.rfc.substring(0,10)!=s.value.curp.substring(0,10)?(r.value.curp="La CURP no coincide con el RFC",n.value=!1,document.getElementById("curp").focus()):(r.value.curp="",B()):(r.value.curp="La CURP no tiene un formato válido",n.value=!1,document.getElementById("curp").focus()):(r.value.curp="La CURP es obligatoria",n.value=!1,document.getElementById("curp").focus())}function B(){s.value.sexo?s.value.sexo=="MASCULINO"&&s.value.curp.substring(10,11)!="H"||s.value.sexo=="FEMENINO"&&s.value.curp.substring(10,11)!="M"?(r.value.sexo="El sexo no coincide con la CURP",n.value=!1):r.value.sexo="":(r.value.sexo="El sexo es obligatorio",n.value=!1)}function Z(){s.value.nivelAcademico?r.value.nivelAcademico="":(r.value.nivelAcademico="El nivel académico es obligatorio",n.value=!1,document.getElementById("nivelAcademico").focus())}function G(){s.value.correoInstitucional?/^[^\s@]+@[^\s@]+\.[^\s@]+$/i.test(s.value.correoInstitucional)?r.value.correoInstitucional="":(r.value.correoInstitucional="El correo no tiene un formato válido",n.value=!1):(r.value.correoInstitucional="El correo institucional es obligatorio",n.value=!1)}function H(){s.value.numeroTarjeta?r.value.numeroTarjeta="":(r.value.numeroTarjeta="El número de tarjeta es obligatorio",n.value=!1)}function J(){s.value.departamento?r.value.departamento="":(r.value.departamento="Debe seleccionar un departamento",n.value=!1)}function Y(){s.value.tipoMovimiento?r.value.tipoMovimiento="":(r.value.tipoMovimiento="Debe seleccionar el tipo de movimiento",n.value=!1)}function Q(){var u=new Date().getFullYear();s.value.fechaIngreso?s.value.fechaIngreso.substring(0,4)<1900||s.value.fechaIngreso.substring(0,4)>u?(r.value.fechaIngreso="La fecha de ingreso no es válida",n.value=!1):r.value.fechaIngreso="":(r.value.fechaIngreso="La fecha de ingreso es obligatoria",n.value=!1)}function K(){s.value.estado?s.value.estado=="BAJA"&&!s.value.fechaBaja?(r.value.fechaBaja="Debe ingresar la fecha de baja",n.value=!1):(r.value.fechaBaja="",r.value.estado=""):(r.value.estado="El estado es obligatorio",n.value=!1)}const L=()=>{if(A.value=!0,n.value=!0,O(),$(),T(),B(),Z(),G(),H(),J(),Y(),Q(),K(),!n.value){V("error","Verifique los campos marcados en rojo");return}};return{data:s,validate:L,submit:()=>{L();let u={...s.value};if((s.value.discapacidades==null||s.value.discapacidades==null||s.value.discapacidades=="")&&(u.discapacidades=[]),(s.value.lenguas==null||s.value.lenguas==null||s.value.lenguas=="")&&(u.lenguas=[]),a.value){var W=s.value.id;k("¿Estás seguro?","Se actualizarán los datos del empleado","warning","Sí, actualizar","No, cancelar").then(N=>{N?y.putEmpleado(u,W).then(E=>{E.status==200?z("¡Éxito!","El empleado se ha actualizado correctamente","success","Aceptar").then(()=>{V("info","Será redirigido a la lista de empleados"),setTimeout(()=>{b.push({name:"empleados"})},3e3)}):q("Error",E.response.data.mensaje,"error","Aceptar")}).catch(E=>{V("error","Ocurrió un error al actualizar el empleado")}):V("info","No se actualizaron los datos")})}else k("¿Estás seguro?","Se registrarán los datos del empleado","warning","Sí, registrar","No, cancelar").then(N=>{N?y.postEmpleado(u).then(E=>{E.status==200?z("¡Éxito!","El empleado se ha registrado correctamente","success","Aceptar").then(()=>{b.push({name:"empleados"})}):q("Error",E.response.data.mensaje,"error","Aceptar")}).catch(E=>{V("error","Ocurrió un error al registrar el empleado")}):V("info","No se registraron los datos")})},cancelar:()=>{k("¿Deseas cancelar?","Los cambios no guardados se perderán","question","Sí, cancelar","No, regresar").then(u=>{u&&b.push({name:"empleados"})})},opcDiscapacidades:g,opcSexo:M,opcNivelAcademico:h,error:r,validated:A,isEdit:a,opcDepartamento:l,opcTipoMovimiento:R,opcEstado:F,opcLenguas:U,vNombre:O,vRfc:$,vCurp:T,vSexo:B,vNivelAcademico:Z,vCorreoInstitucional:G,vNumeroTarjeta:H,vDepartamento:J,vTipoMovimiento:Y,vFechaIngreso:Q,vEstado:K,eliminar:()=>{x.fire({title:"Se requiere confirmación",text:"Esta acción eliminará al empleado de forma permanente y no se puede revertir, se recomienda dar de baja al empleado en lugar de eliminarlo. El administrador del sitio será notificado de esta acción.",icon:"warning",iconColor:"#dc3545",input:"checkbox",inputValue:0,inputPlaceholder:"Entiendo, quiero continuar",confirmButtonText:'Continuar <i class="bi bi-shield-exclamation"></i>',confirmButtonColor:"#dc3545",cancelButtonText:"Cancelar</i>",showCancelButton:!0,inputValidator:u=>!u&&"Debes confirmar que entiendes las consecuencias de esta acción"}).then(u=>{u.value&&store.deleteEmpleado(s.value.id).then(()=>{x.fire({icon:"success",title:"¡Éxito!",text:"El empleado ha sido eliminado de forma permanente"}).then(()=>{b.push({name:"empleados"})})}).catch(W=>{V("error","Ocurrió un error al eliminar el empleado")})})},goBack:()=>b.go(-1),verHistorial:()=>b.push({name:"empleados_historial",params:{id:s.value.id}})}},components:{InputText:te}}),ge={class:"container-lg pt-4 my-3"},Ce={class:"card shadow-5 border-round-2xl overflow-hidden"},Ve={class:"d-flex relative card-header py-0 pe-0"},Ee={class:"flex text-center"},ye={key:0,class:"bi bi-person-fill-gear fw-bold h1 my-0"},Ie={key:1,class:"bi bi-person-fill-add fw-bold h1 my-0"},we={class:"fw-bold h4 align-self-center ms-3 my-0"},Ae={id:"form"},Se={class:"card-body"},ke={class:"grid"},Te={class:"col-12"},Be=o("span",{class:"fs-5 fw-bold"},"Datos personales",-1),Le={class:"col-12 lg:col-6"},Ne=o("label",{for:"nombre",class:"form-label"},[f("Nombre completo"),o("b",{class:"p-error"},"*")],-1),je={key:0,class:"p-error"},De={class:"col-12 md:col-4 lg:col-3"},Me=o("label",{for:"rfc",class:"form-label"},[f("RFC"),o("b",{class:"p-error"},"*")],-1),Ue={key:0,class:"p-error"},Re={class:"col-12 md:col-4 lg:col-3"},Fe=o("label",{for:"curp",class:"form-label"},[f("CURP"),o("b",{class:"p-error"},"*")],-1),Pe={key:0,class:"p-error"},ze={key:0,class:"col-4 md:col-4 lg:col-3"},qe=o("label",{for:"edad",class:"form-label"},"Edad",-1),Oe=o("label",{for:"genero",class:"form-label"},[f("Sexo"),o("b",{class:"text-danger"},"*")],-1),$e={key:0,class:"p-error"},Ze={class:"col-12 md:col-6"},Ge=o("label",{for:"nivelAcademico",class:"form-label"},[f("Nivel Académico"),o("b",{class:"text-danger"},"*")],-1),He={key:0,class:"p-error"},Je={class:"col-12 md:col-6"},Ye=o("label",{for:"inputCorreo",class:"form-label"},"Correo electrónico",-1),Qe={key:0,class:"p-error"},Ke={class:"col-12 md:col-6"},We=o("label",{for:"profesion",class:"form-label"},"Profesión",-1),Xe={class:"col-12 md:col-6 lg:col-6"},_e=o("label",{for:"genero",class:"form-label"},"Lenguas indígenas",-1),xe={class:"col-12 md:col-6 lg:col-6"},eo=o("label",{for:"genero",class:"form-label"},"Discapacidades",-1),oo=o("div",{class:"col-12"},[o("span",{class:"fs-5 fw-bold"},"Datos laborales")],-1),ao={class:"col-6 md:col-6 lg:col-4"},lo=o("label",{for:"tarjeta",class:"form-label"},[f("Número de tarjeta"),o("b",{class:"text-danger"},"*")],-1),so={key:0,class:"p-error"},ro={class:"col-12 md:col-6 lg:col-4"},no=o("label",{for:"inputDepartamento",class:"form-label"},[f("Departamento de adscripción"),o("b",{class:"text-danger"},"*")],-1),to={key:0,class:"p-error"},io={class:"col-6 md:col-6 lg:col-4"},co=o("label",{for:"inputTipoMovimiento",class:"form-label"},[f("Tipo de movimiento"),o("b",{class:"text-danger"},"*")],-1),uo={key:0,class:"p-error"},mo={class:"col-6 md:col-4"},po=o("label",{for:"fechaIngreso",class:"form-label"},[f("Fecha de ingreso"),o("b",{class:"text-danger"},"*")],-1),vo={key:0,class:"p-error"},fo={class:"col-6 md:col-4"},ho=o("label",{for:"inputEstado",class:"form-label"},[f("Estado del empleado"),o("b",{class:"text-danger"},"*")],-1),bo={key:0,class:"p-error"},go={key:1,class:"col-6 md:col-4"},Co=o("label",{for:"fechaBaja",class:"form-label"},"Fecha de baja",-1),Vo={key:0,class:"p-error"},Eo={class:"col-12 md:col-12"},yo=o("label",{for:"inputComentario",class:"form-label"},"Comentarios",-1),Io=o("small",null,[o("b",{class:"text-danger"},"*"),f(" Campos obligatorios")],-1),wo={class:"card-footer d-flex"};function Ao(e,a,M,U,R,F){const g=I("Button"),h=I("InputText"),C=I("Dropdown"),b=I("MultiSelect"),y=I("TextArea"),w=ie("tooltip");return t(),i("div",ge,[o("div",Ce,[o("div",Ve,[o("span",Ee,[e.isEdit?(t(),i("i",ye)):(t(),i("i",Ie)),o("span",we,p(e.isEdit?" Editar":"Registrar")+" empleado ",1)]),d(g,{icon:"pi pi-times",severity:"danger",size:"small",onClick:e.goBack,class:"ms-auto border-noround float-end hover:bg-red-500 hover:text-white",text:"",style:{height:"48px"}},null,8,["onClick"])]),o("form",Ae,[o("div",Se,[o("div",ke,[o("div",Te,[Be,d(g,{icon:"pi pi-history",class:"float-end bg-gray-600 hover:bg-gray-300 hover:text-color border-none",onClick:e.verHistorial,label:"historial",size:"small",severity:"secondary"},null,8,["onClick"])]),o("div",Le,[Ne,d(h,{modelValue:e.data.nombre,"onUpdate:modelValue":a[0]||(a[0]=l=>e.data.nombre=l),placeholder:"Nombre completo, incluyendo apellidos",class:v(["w-full",{"p-invalid":e.error.nombre&&e.validated}]),id:"nombre",onInput:e.vNombre},null,8,["modelValue","class","onInput"]),e.validated?(t(),i("small",je,p(e.error.nombre||""),1)):c("",!0)]),o("div",De,[Me,d(h,{modelValue:e.data.rfc,"onUpdate:modelValue":a[1]||(a[1]=l=>e.data.rfc=l),placeholder:"RFC con homoclave",class:v(["w-full",{"p-invalid":e.error.rfc&&e.validated}]),id:"rfc",minlength:"13",maxlength:"13",autocomplete:"off",onInput:e.vRfc},null,8,["modelValue","class","onInput"]),e.validated?(t(),i("small",Ue,p(e.error.rfc||""),1)):c("",!0)]),o("div",Re,[Fe,d(h,{modelValue:e.data.curp,"onUpdate:modelValue":a[2]||(a[2]=l=>e.data.curp=l),placeholder:"CURP (18 caracteres)",class:v(["w-full",{"p-invalid":e.error.curp&&e.validated}]),id:"curp",minlength:"18",maxlength:"18",autocomplete:"off",onInput:e.vCurp},null,8,["modelValue","class","onInput"]),e.validated?(t(),i("small",Pe,p(e.error.curp||""),1)):c("",!0)]),e.isEdit?(t(),i("div",ze,[qe,j(d(h,{modelValue:e.data.edad,"onUpdate:modelValue":a[3]||(a[3]=l=>e.data.edad=l),class:"w-full",readonly:e.isEdit},null,8,["modelValue","readonly"]),[[w,"Calculado automáticamente",void 0,{top:!0}]])])):c("",!0),o("div",{class:v([{"col-8 md:col-6":!e.isEdit},{"col-12 md:col-6 lg:col-3":e.isEdit}])},[Oe,d(C,{modelValue:e.data.sexo,"onUpdate:modelValue":a[4]||(a[4]=l=>e.data.sexo=l),options:e.opcSexo,optionLabel:"nombre",optionValue:"nombre",placeholder:"Seleccione el sexo",class:v(["w-full",{"p-invalid":e.error.sexo&&e.validated}]),showClear:"",onChange:e.vSexo},null,8,["modelValue","options","class","onChange"]),e.validated?(t(),i("small",$e,p(e.error.sexo||""),1)):c("",!0)],2),o("div",Ze,[Ge,d(C,{modelValue:e.data.nivelAcademico,"onUpdate:modelValue":a[5]||(a[5]=l=>e.data.nivelAcademico=l),options:e.opcNivelAcademico,optionLabel:"nombre",inputId:"nivelAcademico",optionValue:"nombre",placeholder:"Seleccione el nivel académico",showClear:"",class:v(["w-full",{"p-invalid":e.error.nivelAcademico&&e.validated}]),onChange:e.vNivelAcademico},null,8,["modelValue","options","class","onChange"]),e.validated?(t(),i("small",He,p(e.error.nivelAcademico||""),1)):c("",!0)]),o("div",Je,[Ye,d(h,{modelValue:e.data.correoInstitucional,"onUpdate:modelValue":a[6]||(a[6]=l=>e.data.correoInstitucional=l),placeholder:"Correo (institucional)",class:v(["w-full",{"p-invalid":e.error.correoInstitucional&&e.validated}]),id:"correo",onInput:e.vCorreoInstitucional,required:""},null,8,["modelValue","class","onInput"]),e.validated?(t(),i("small",Qe,p(e.error.correoInstitucional||""),1)):c("",!0)]),o("div",Ke,[We,d(h,{modelValue:e.data.profesion,"onUpdate:modelValue":a[7]||(a[7]=l=>e.data.profesion=l),placeholder:"Profesión",class:v(["w-full"]),id:"profesion"},null,8,["modelValue"])]),o("div",Xe,[_e,(t(),D(b,{modelValue:e.data.lenguas,"onUpdate:modelValue":a[8]||(a[8]=l=>e.data.lenguas=l),options:e.opcLenguas,optionLabel:"nombre",placeholder:"Puede dejar este campo en blanco",selectedItemsLabel:"{0} discapacidades seleccionadas",maxSelectedLabels:3,selectionLimit:5,class:"w-full",filter:"",showToggleAll:!1,key:e.opcDiscapacidades.length},null,8,["modelValue","options"]))]),o("div",xe,[eo,(t(),D(b,{modelValue:e.data.discapacidades,"onUpdate:modelValue":a[9]||(a[9]=l=>e.data.discapacidades=l),options:e.opcDiscapacidades,optionLabel:"nombre",placeholder:"Puede dejar este campo en blanco",selectedItemsLabel:"{0} discapacidades seleccionadas",maxSelectedLabels:3,selectionLimit:5,class:"w-full",filter:"",showToggleAll:!1,key:e.opcDiscapacidades.length},null,8,["modelValue","options"]))]),oo,o("div",ao,[lo,d(h,{modelValue:e.data.numeroTarjeta,"onUpdate:modelValue":a[10]||(a[10]=l=>e.data.numeroTarjeta=l),placeholder:"Número de tarjeta",type:"number",class:v(["w-full",{"p-invalid":e.error.numeroTarjeta&&e.validated}]),id:"tarjeta",onInput:e.vNumeroTarjeta},null,8,["modelValue","class","onInput"]),e.validated?(t(),i("small",so,p(e.error.numeroTarjeta||""),1)):c("",!0)]),o("div",ro,[no,d(C,{modelValue:e.data.departamento,"onUpdate:modelValue":a[11]||(a[11]=l=>e.data.departamento=l),options:e.opcDepartamento,optionLabel:"nombre",placeholder:"Seleccione el departamento",showClear:"",class:v(["w-full",{"p-invalid":e.error.departamento&&e.validated}]),onChange:e.vDepartamento},null,8,["modelValue","options","class","onChange"]),e.validated?(t(),i("small",to,p(e.error.departamento||""),1)):c("",!0)]),o("div",io,[co,d(C,{modelValue:e.data.tipoMovimiento,"onUpdate:modelValue":a[12]||(a[12]=l=>e.data.tipoMovimiento=l),options:e.opcTipoMovimiento,optionLabel:"nombre",optionValue:"nombre",placeholder:"Seleccione el tipo de movimiento",showClear:"",class:v(["w-full",{"p-invalid":e.error.tipoMovimiento&&e.validated}]),onChange:e.vTipoMovimiento},null,8,["modelValue","options","class","onChange"]),e.validated?(t(),i("small",uo,p(e.error.tipoMovimiento||""),1)):c("",!0)]),o("div",mo,[po,j(o("input",{"onUpdate:modelValue":a[13]||(a[13]=l=>e.data.fechaIngreso=l),type:"date",placeholder:"dd/mm/aaaa",class:"form-control",id:"fechaIngreso",onChange:a[14]||(a[14]=(...l)=>e.vFechaIngreso&&e.vFechaIngreso(...l))},null,544),[[X,e.data.fechaIngreso]]),e.validated?(t(),i("small",vo,p(e.error.fechaIngreso||""),1)):c("",!0)]),o("div",fo,[ho,d(C,{modelValue:e.data.estado,"onUpdate:modelValue":a[15]||(a[15]=l=>e.data.estado=l),options:e.opcEstado,optionLabel:"nombre",optionValue:"nombre",placeholder:"Seleccione el estado",showClear:"",class:v(["w-full",{"p-invalid":e.error.estado&&e.validated},{"bg-red-50":e.data.estado==="BAJA"},{"bg-yellow-50":e.data.estado==="INACTIVO"},{"bg-green-50":e.data.estado==="ACTIVO"}]),onChange:e.vEstado,required:""},null,8,["modelValue","options","class","onChange"]),e.validated?(t(),i("small",bo,p(e.error.estado||""),1)):c("",!0)]),e.data.estado==="BAJA"?(t(),i("div",go,[Co,j(o("input",{"onUpdate:modelValue":a[16]||(a[16]=l=>e.data.fechaBaja=l),type:"date",placeholder:"dd/mm/aaaa",class:"form-control p-invalid",id:"fechaBaja"},null,512),[[X,e.data.fechaBaja]]),e.validated?(t(),i("small",Vo,p(e.error.fechaBaja||""),1)):c("",!0)])):c("",!0),o("div",Eo,[yo,d(y,{modelValue:e.data.comentarios,"onUpdate:modelValue":a[17]||(a[17]=l=>e.data.comentarios=l),placeholder:"Comentario o descripción (opcional)",class:v(["w-full"]),id:"comentarios",rows:"1",autoResize:""},null,8,["modelValue"])])]),Io]),o("div",wo,[e.isEdit?(t(),D(g,{key:0,icon:"pi pi-trash",class:"me-2",label:"Eliminar",onClick:e.eliminar,severity:"danger"},null,8,["onClick"])):c("",!0),d(g,{icon:"pi pi-check",id:"submitButton",class:"me-2 ms-auto",label:"Guardar",onClick:e.submit},null,8,["onClick"]),d(g,{icon:"pi pi-times",class:"ms-2 float-end",severity:"secondary",label:"Cancelar",onClick:e.cancelar},null,8,["onClick"])])])])])}const Do=ae(be,[["render",Ao]]);export{Do as E};
