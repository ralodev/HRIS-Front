import{g as oe,_ as ae,r as m,k as le,u as se,o as ne,n as re,l as ie,a as w,m as te,b as r,c as t,d as o,t as p,e as c,j as L,p as d,q as v,v as D,x as X,y as de,z as ce,A as ue,B as me,C as pe,E as ve,i as _,S as x,G as f}from"./index-73aa4d39.js";import{u as fe}from"./empleadoStore-4a2c7da7.js";import{u as he}from"./departamentoStore-2bb750aa.js";const be=oe({name:"EmpleadoForm",watch:{},props:{isEdit:{type:Boolean,default:!1}},setup(e){const a=m(e.isEdit),M=m(de),O=m(ce),P=m(ue),F=m(me),g=m(pe),b=m(ve),C=le(),h=se(),E=fe(),S=he(),l=m([]),k=m(!1),i=m(!1),n=m({}),s=m({}),z=m(null),T=_(),{showToast:V,showSuccessAlert:Z,showConfirmAlert:B,showErrorAlert:N,showLoading:Lo,closeLoading:ee}=_();ne(()=>{T.showLoading("Cargando datos..."),S.getDepartamentos().then(()=>{l.value=S.data,l.value.forEach(u=>{delete u.empleados}),a.value?(z.value=C.params.id,E.getEmpleado(z.value).then(()=>{s.value=E.data,re(()=>{T.closeLoading(),k.value=!0,U(),ee()})})):(T.closeLoading(),s.value={nombre:"RAUL LOPEZ CRUZ",rfc:"LOCR960727HOC",curp:"LOCR960727HOCPRL03",sexo:"MASCULINO",discapacidades:"",lenguas:"",nivelAcademico:"LICENCIATURA",correoInstitucional:"LOPEZ.CRUZ@CORREO.MAIL",profesion:"PROFESOR",numeroTarjeta:Number("69420"),departamento:null,tipoMovimiento:"PREJUBILACION",fechaIngreso:"",estado:"ACTIVO",fechaBaja:"",comentarios:"ESTO ES UNA PRUEBA"})})});function H(){s.value.nombre?n.value.nombre="":(n.value.nombre="El nombre es obligatorio",i.value=!1)}function q(){s.value.rfc?/^[A-Z]{4}\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])[A-Z\d]{3}$/.test(s.value.rfc)?(n.value.rfc="",j()):(n.value.rfc="El RFC no tiene un formato válido",i.value=!1,document.getElementById("rfc").focus()):(n.value.rfc="El RFC es obligatorio",i.value=!1,document.getElementById("rfc").focus())}function j(){s.value.curp?/^[A-Z]{4}\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])[HM](AS|BC|BS|CC|CH|CL|CM|CS|DF|DG|GR|GT|HG|JC|MC|MN|MS|NE|NL|NT|OC|PL|QT|QR|SP|SL|SR|TC|TL|TS|VZ|YN|ZS)[A-Z]{3}[0-9A-Z]{2}$/.test(s.value.curp)?s.value.rfc.substring(0,10)!=s.value.curp.substring(0,10)?(n.value.curp="La CURP no coincide con el RFC",i.value=!1,document.getElementById("curp").focus()):(n.value.curp="",R()):(n.value.curp="La CURP no tiene un formato válido",i.value=!1,document.getElementById("curp").focus()):(n.value.curp="La CURP es obligatoria",i.value=!1,document.getElementById("curp").focus())}function R(){s.value.sexo?s.value.sexo=="MASCULINO"&&s.value.curp.substring(10,11)!="H"||s.value.sexo=="FEMENINO"&&s.value.curp.substring(10,11)!="M"?(n.value.sexo="El sexo no coincide con la CURP",i.value=!1):n.value.sexo="":(n.value.sexo="El sexo es obligatorio",i.value=!1)}function $(){s.value.nivelAcademico?n.value.nivelAcademico="":(n.value.nivelAcademico="El nivel académico es obligatorio",i.value=!1,document.getElementById("nivelAcademico").focus())}function G(){s.value.correoInstitucional?/^[^\s@]+@[^\s@]+\.[^\s@]+$/i.test(s.value.correoInstitucional)?n.value.correoInstitucional="":(n.value.correoInstitucional="El correo no tiene un formato válido",i.value=!1):(n.value.correoInstitucional="El correo institucional es obligatorio",i.value=!1)}function J(){s.value.numeroTarjeta?n.value.numeroTarjeta="":(n.value.numeroTarjeta="El número de tarjeta es obligatorio",i.value=!1)}function Y(){s.value.departamento?n.value.departamento="":(n.value.departamento="Debe seleccionar un departamento",i.value=!1)}function Q(){s.value.tipoMovimiento?n.value.tipoMovimiento="":(n.value.tipoMovimiento="Debe seleccionar el tipo de movimiento",i.value=!1)}function K(){var u=new Date().getFullYear();s.value.fechaIngreso?s.value.fechaIngreso.substring(0,4)<1900||s.value.fechaIngreso.substring(0,4)>u?(n.value.fechaIngreso="La fecha de ingreso no es válida",i.value=!1):n.value.fechaIngreso="":(n.value.fechaIngreso="La fecha de ingreso es obligatoria",i.value=!1)}function W(){s.value.estado?s.value.estado=="BAJA"&&!s.value.fechaBaja?(n.value.fechaBaja="Debe ingresar la fecha de baja",i.value=!1):(n.value.fechaBaja="",n.value.estado=""):(n.value.estado="El estado es obligatorio",i.value=!1)}const U=async()=>(k.value=!0,i.value=!0,H(),q(),j(),R(),$(),G(),J(),Y(),Q(),W(),K(),!!i.value);return{data:s,validate:U,submit:()=>{U().then(A=>{if(!A){console.log(A),V("error","Verifique los campos marcados en rojo");return}});let u={...s.value};if((s.value.discapacidades==null||s.value.discapacidades==null||s.value.discapacidades=="")&&(u.discapacidades=[]),(s.value.lenguas==null||s.value.lenguas==null||s.value.lenguas=="")&&(u.lenguas=[]),a.value){var I=s.value.id;B("¿Estás seguro?","Se actualizarán los datos del empleado","warning","Sí, actualizar","No, cancelar").then(A=>{A?E.putEmpleado(u,I).then(y=>{y.status==200?Z("¡Éxito!","El empleado se ha actualizado correctamente","success","Aceptar").then(()=>{V("info","Será redirigido a la lista de empleados"),setTimeout(()=>{h.push({name:"empleados"})},3e3)}):N("Error",y.response.data.mensaje,"error","Aceptar")}).catch(y=>{V("error","Ocurrió un error al actualizar el empleado")}):V("info","No se actualizaron los datos")})}else B("¿Estás seguro?","Se registrarán los datos del empleado","warning","Sí, registrar","No, cancelar").then(A=>{A?E.postEmpleado(u).then(y=>{y.status==200?Z("¡Éxito!","El empleado se ha registrado correctamente","success","Aceptar").then(()=>{h.push({name:"empleados"})}):N("Error",y.response.data.mensaje,"error","Aceptar")}).catch(y=>{V("error","Ocurrió un error al registrar el empleado")}):V("info","No se registraron los datos")})},cancelar:()=>{B("¿Deseas cancelar?","Los cambios no guardados se perderán","question","Sí, cancelar","No, regresar").then(u=>{u&&h.push({name:"empleados"})})},opcDiscapacidades:g,opcSexo:M,opcNivelAcademico:b,error:n,validated:k,isEdit:a,opcDepartamento:l,opcTipoMovimiento:P,opcEstado:F,opcLenguas:O,vNombre:H,vRfc:q,vCurp:j,vSexo:R,vNivelAcademico:$,vCorreoInstitucional:G,vNumeroTarjeta:J,vDepartamento:Y,vTipoMovimiento:Q,vFechaIngreso:K,vEstado:W,eliminar:()=>{x.fire({title:"Se requiere confirmación",text:"Esta acción eliminará al empleado de forma permanente y no se puede revertir, se recomienda dar de baja al empleado en lugar de eliminarlo. El administrador del sitio será notificado de esta acción.",icon:"warning",iconColor:"#dc3545",input:"checkbox",inputValue:0,inputPlaceholder:"Entiendo, quiero continuar",confirmButtonText:'Continuar <i class="bi bi-shield-exclamation"></i>',confirmButtonColor:"#dc3545",cancelButtonText:"Cancelar</i>",showCancelButton:!0,inputValidator:u=>!u&&"Debes confirmar que entiendes las consecuencias de esta acción"}).then(u=>{u.value&&E.deleteEmpleado(s.value.id).then(I=>{I.status==200||I.status==204?x.fire({icon:"success",title:"¡Éxito!",text:"El empleado ha sido eliminado de forma permanente"}).then(()=>{h.push({name:"empleados"})}):N("Error",I.response.data.mensaje,"error","Aceptar")}).catch(I=>{console.log(I),V("error","Ocurrió un error al eliminar el empleado")})})},verExpediente:()=>h.push({name:"empleados_expediente",params:{id:s.value.id}}),goBack:()=>h.go(-1),verHistorial:()=>h.push({name:"empleados_historial",params:{id:s.value.id}})}},components:{InputText:ie}}),ge={class:"container-lg pt-4 my-3"},Ce={class:"card shadow-5 border-round-2xl overflow-hidden"},Ee={class:"d-flex relative card-header py-0 pe-0"},Ve={class:"flex text-center"},Ie={key:0,class:"bi bi-person-fill-gear fw-bold h1 my-0"},ye={key:1,class:"bi bi-person-fill-add fw-bold h1 my-0"},Ae={class:"fw-bold h4 align-self-center ms-3 my-0"},we={id:"form"},Le={class:"card-body"},Se={class:"grid"},ke={class:"col-12"},Te=o("span",{class:"fs-5 fw-bold"},"Datos personales",-1),Be={class:"col-12 lg:col-6"},Ne=o("label",{for:"nombre",class:"form-label"},[f("Nombre completo"),o("b",{class:"p-error"},"*")],-1),je={key:0,class:"p-error"},Re={class:"col-12 md:col-4 lg:col-3"},Ue=o("label",{for:"rfc",class:"form-label"},[f("RFC"),o("b",{class:"p-error"},"*")],-1),De={key:0,class:"p-error"},Me={class:"col-12 md:col-4 lg:col-3"},Oe=o("label",{for:"curp",class:"form-label"},[f("CURP"),o("b",{class:"p-error"},"*")],-1),Pe={key:0,class:"p-error"},Fe={key:0,class:"col-4 md:col-4 lg:col-3"},ze=o("label",{for:"edad",class:"form-label"},"Edad",-1),Ze=o("label",{for:"genero",class:"form-label"},[f("Sexo"),o("b",{class:"text-danger"},"*")],-1),He={key:0,class:"p-error"},qe={class:"col-12 md:col-6"},$e=o("label",{for:"nivelAcademico",class:"form-label"},[f("Nivel Académico"),o("b",{class:"text-danger"},"*")],-1),Ge={key:0,class:"p-error"},Je={class:"col-12 md:col-6"},Ye=o("label",{for:"inputCorreo",class:"form-label"},"Correo electrónico",-1),Qe={key:0,class:"p-error"},Ke={class:"col-12 md:col-6"},We=o("label",{for:"profesion",class:"form-label"},"Profesión",-1),Xe={class:"col-12 md:col-6 lg:col-6"},_e=o("label",{for:"genero",class:"form-label"},"Lenguas indígenas",-1),xe={class:"col-12 md:col-6 lg:col-6"},eo=o("label",{for:"genero",class:"form-label"},"Discapacidades",-1),oo=o("div",{class:"col-12"},[o("span",{class:"fs-5 fw-bold"},"Datos laborales")],-1),ao={class:"col-6 md:col-6 lg:col-4"},lo=o("label",{for:"tarjeta",class:"form-label"},[f("Número de tarjeta"),o("b",{class:"text-danger"},"*")],-1),so={key:0,class:"p-error"},no={class:"col-12 md:col-6 lg:col-4"},ro=o("label",{for:"inputDepartamento",class:"form-label"},[f("Departamento de adscripción"),o("b",{class:"text-danger"},"*")],-1),io={key:0,class:"p-error"},to={class:"col-6 md:col-6 lg:col-4"},co=o("label",{for:"inputTipoMovimiento",class:"form-label"},[f("Tipo de movimiento"),o("b",{class:"text-danger"},"*")],-1),uo={key:0,class:"p-error"},mo={class:"col-6 md:col-4"},po=o("label",{for:"fechaIngreso",class:"form-label"},[f("Fecha de ingreso"),o("b",{class:"text-danger"},"*")],-1),vo={key:0,class:"p-error"},fo={class:"col-6 md:col-4"},ho=o("label",{for:"inputEstado",class:"form-label"},[f("Estado del empleado"),o("b",{class:"text-danger"},"*")],-1),bo={key:0,class:"p-error"},go={key:1,class:"col-6 md:col-4"},Co=o("label",{for:"fechaBaja",class:"form-label"},"Fecha de baja",-1),Eo={key:0,class:"p-error"},Vo={class:"col-12 md:col-12"},Io=o("label",{for:"inputComentario",class:"form-label"},"Comentarios",-1),yo=o("small",null,[o("b",{class:"text-danger"},"*"),f(" Campos obligatorios")],-1),Ao={class:"card-footer d-flex"};function wo(e,a,M,O,P,F){const g=w("Button"),b=w("InputText"),C=w("Dropdown"),h=w("MultiSelect"),E=w("TextArea"),S=te("tooltip");return r(),t("div",ge,[o("div",Ce,[o("div",Ee,[o("span",Ve,[e.isEdit?(r(),t("i",Ie)):(r(),t("i",ye)),o("span",Ae,p(e.isEdit?" Editar":"Registrar")+" empleado ",1)]),c(g,{icon:"pi pi-times",severity:"danger",size:"small",onClick:e.goBack,class:"ms-auto border-noround float-end hover:bg-red-500 hover:text-white",text:"",style:{height:"48px"}},null,8,["onClick"])]),o("form",we,[o("div",Le,[o("div",Se,[o("div",ke,[Te,e.isEdit?(r(),L(g,{key:0,icon:"pi pi-history",class:"float-end",onClick:e.verHistorial,label:"Historial",size:"small",severity:"secondary"},null,8,["onClick"])):d("",!0),e.isEdit?(r(),L(g,{key:1,icon:"pi pi-book",class:"float-end me-2",onClick:e.verExpediente,label:"Expediente",size:"small",severity:"help"},null,8,["onClick"])):d("",!0)]),o("div",Be,[Ne,c(b,{modelValue:e.data.nombre,"onUpdate:modelValue":a[0]||(a[0]=l=>e.data.nombre=l),placeholder:"Nombre completo, incluyendo apellidos",class:v(["w-full",{"p-invalid":e.error.nombre&&e.validated}]),id:"nombre",onInput:e.vNombre},null,8,["modelValue","class","onInput"]),e.validated?(r(),t("small",je,p(e.error.nombre||""),1)):d("",!0)]),o("div",Re,[Ue,c(b,{modelValue:e.data.rfc,"onUpdate:modelValue":a[1]||(a[1]=l=>e.data.rfc=l),placeholder:"RFC con homoclave",class:v(["w-full",{"p-invalid":e.error.rfc&&e.validated}]),id:"rfc",minlength:"13",maxlength:"13",autocomplete:"off",onInput:e.vRfc},null,8,["modelValue","class","onInput"]),e.validated?(r(),t("small",De,p(e.error.rfc||""),1)):d("",!0)]),o("div",Me,[Oe,c(b,{modelValue:e.data.curp,"onUpdate:modelValue":a[2]||(a[2]=l=>e.data.curp=l),placeholder:"CURP (18 caracteres)",class:v(["w-full",{"p-invalid":e.error.curp&&e.validated}]),id:"curp",minlength:"18",maxlength:"18",autocomplete:"off",onInput:e.vCurp},null,8,["modelValue","class","onInput"]),e.validated?(r(),t("small",Pe,p(e.error.curp||""),1)):d("",!0)]),e.isEdit?(r(),t("div",Fe,[ze,D(c(b,{modelValue:e.data.edad,"onUpdate:modelValue":a[3]||(a[3]=l=>e.data.edad=l),class:"w-full",readonly:e.isEdit},null,8,["modelValue","readonly"]),[[S,"Calculado automáticamente",void 0,{top:!0}]])])):d("",!0),o("div",{class:v([{"col-8 md:col-6":!e.isEdit},{"col-12 md:col-6 lg:col-3":e.isEdit}])},[Ze,c(C,{modelValue:e.data.sexo,"onUpdate:modelValue":a[4]||(a[4]=l=>e.data.sexo=l),options:e.opcSexo,optionLabel:"nombre",optionValue:"nombre",placeholder:"Seleccione el sexo",class:v(["w-full",{"p-invalid":e.error.sexo&&e.validated}]),showClear:"",onChange:e.vSexo},null,8,["modelValue","options","class","onChange"]),e.validated?(r(),t("small",He,p(e.error.sexo||""),1)):d("",!0)],2),o("div",qe,[$e,c(C,{modelValue:e.data.nivelAcademico,"onUpdate:modelValue":a[5]||(a[5]=l=>e.data.nivelAcademico=l),options:e.opcNivelAcademico,optionLabel:"nombre",inputId:"nivelAcademico",optionValue:"nombre",placeholder:"Seleccione el nivel académico",showClear:"",class:v(["w-full",{"p-invalid":e.error.nivelAcademico&&e.validated}]),onChange:e.vNivelAcademico},null,8,["modelValue","options","class","onChange"]),e.validated?(r(),t("small",Ge,p(e.error.nivelAcademico||""),1)):d("",!0)]),o("div",Je,[Ye,c(b,{modelValue:e.data.correoInstitucional,"onUpdate:modelValue":a[6]||(a[6]=l=>e.data.correoInstitucional=l),placeholder:"Correo (institucional)",class:v(["w-full",{"p-invalid":e.error.correoInstitucional&&e.validated}]),id:"correo",onInput:e.vCorreoInstitucional,required:""},null,8,["modelValue","class","onInput"]),e.validated?(r(),t("small",Qe,p(e.error.correoInstitucional||""),1)):d("",!0)]),o("div",Ke,[We,c(b,{modelValue:e.data.profesion,"onUpdate:modelValue":a[7]||(a[7]=l=>e.data.profesion=l),placeholder:"Profesión",class:v(["w-full"]),id:"profesion"},null,8,["modelValue"])]),o("div",Xe,[_e,(r(),L(h,{modelValue:e.data.lenguas,"onUpdate:modelValue":a[8]||(a[8]=l=>e.data.lenguas=l),options:e.opcLenguas,optionLabel:"nombre",placeholder:"Puede dejar este campo en blanco",selectedItemsLabel:"{0} discapacidades seleccionadas",maxSelectedLabels:3,selectionLimit:5,class:"w-full",filter:"",showToggleAll:!1,key:e.opcDiscapacidades.length},null,8,["modelValue","options"]))]),o("div",xe,[eo,(r(),L(h,{modelValue:e.data.discapacidades,"onUpdate:modelValue":a[9]||(a[9]=l=>e.data.discapacidades=l),options:e.opcDiscapacidades,optionLabel:"nombre",placeholder:"Puede dejar este campo en blanco",selectedItemsLabel:"{0} discapacidades seleccionadas",maxSelectedLabels:3,selectionLimit:5,class:"w-full",filter:"",showToggleAll:!1,key:e.opcDiscapacidades.length},null,8,["modelValue","options"]))]),oo,o("div",ao,[lo,c(b,{modelValue:e.data.numeroTarjeta,"onUpdate:modelValue":a[10]||(a[10]=l=>e.data.numeroTarjeta=l),placeholder:"Número de tarjeta",type:"number",class:v(["w-full",{"p-invalid":e.error.numeroTarjeta&&e.validated}]),id:"tarjeta",onInput:e.vNumeroTarjeta},null,8,["modelValue","class","onInput"]),e.validated?(r(),t("small",so,p(e.error.numeroTarjeta||""),1)):d("",!0)]),o("div",no,[ro,c(C,{modelValue:e.data.departamento,"onUpdate:modelValue":a[11]||(a[11]=l=>e.data.departamento=l),options:e.opcDepartamento,optionLabel:"nombre",placeholder:"Seleccione el departamento",showClear:"",class:v(["w-full",{"p-invalid":e.error.departamento&&e.validated}]),onChange:e.vDepartamento},null,8,["modelValue","options","class","onChange"]),e.validated?(r(),t("small",io,p(e.error.departamento||""),1)):d("",!0)]),o("div",to,[co,c(C,{modelValue:e.data.tipoMovimiento,"onUpdate:modelValue":a[12]||(a[12]=l=>e.data.tipoMovimiento=l),options:e.opcTipoMovimiento,optionLabel:"nombre",optionValue:"nombre",placeholder:"Seleccione el tipo de movimiento",showClear:"",class:v(["w-full",{"p-invalid":e.error.tipoMovimiento&&e.validated}]),onChange:e.vTipoMovimiento},null,8,["modelValue","options","class","onChange"]),e.validated?(r(),t("small",uo,p(e.error.tipoMovimiento||""),1)):d("",!0)]),o("div",mo,[po,D(o("input",{"onUpdate:modelValue":a[13]||(a[13]=l=>e.data.fechaIngreso=l),type:"date",placeholder:"dd/mm/aaaa",class:"form-control",id:"fechaIngreso",onChange:a[14]||(a[14]=(...l)=>e.vFechaIngreso&&e.vFechaIngreso(...l))},null,544),[[X,e.data.fechaIngreso]]),e.validated?(r(),t("small",vo,p(e.error.fechaIngreso||""),1)):d("",!0)]),o("div",fo,[ho,c(C,{modelValue:e.data.estado,"onUpdate:modelValue":a[15]||(a[15]=l=>e.data.estado=l),options:e.opcEstado,optionLabel:"nombre",optionValue:"nombre",placeholder:"Seleccione el estado",showClear:"",class:v(["w-full",{"p-invalid":e.error.estado&&e.validated},{"bg-red-50":e.data.estado==="BAJA"},{"bg-yellow-50":e.data.estado==="INACTIVO"},{"bg-green-50":e.data.estado==="ACTIVO"}]),onChange:e.vEstado,required:""},null,8,["modelValue","options","class","onChange"]),e.validated?(r(),t("small",bo,p(e.error.estado||""),1)):d("",!0)]),e.data.estado==="BAJA"?(r(),t("div",go,[Co,D(o("input",{"onUpdate:modelValue":a[16]||(a[16]=l=>e.data.fechaBaja=l),type:"date",placeholder:"dd/mm/aaaa",class:"form-control p-invalid",id:"fechaBaja"},null,512),[[X,e.data.fechaBaja]]),e.validated?(r(),t("small",Eo,p(e.error.fechaBaja||""),1)):d("",!0)])):d("",!0),o("div",Vo,[Io,c(E,{modelValue:e.data.comentarios,"onUpdate:modelValue":a[17]||(a[17]=l=>e.data.comentarios=l),placeholder:"Comentario o descripción (opcional)",class:v(["w-full"]),id:"comentarios",rows:"1",autoResize:""},null,8,["modelValue"])])]),yo]),o("div",Ao,[e.isEdit?(r(),L(g,{key:0,icon:"pi pi-trash",class:"me-2",label:"Eliminar",onClick:e.eliminar,severity:"danger"},null,8,["onClick"])):d("",!0),c(g,{icon:"pi pi-check",id:"submitButton",class:"me-2 ms-auto",label:"Guardar",onClick:e.submit},null,8,["onClick"]),c(g,{icon:"pi pi-times",class:"ms-2 float-end",severity:"secondary",label:"Cancelar",onClick:e.cancelar},null,8,["onClick"])])])])])}const Ro=ae(be,[["render",wo]]);export{Ro as E};
