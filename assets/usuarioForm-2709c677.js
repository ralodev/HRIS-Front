import{u as P}from"./adminStore-7b6f1fb3.js";import{g as G,_ as I,r as b,k as j,u as H,o as $,l as F,a as O,m as K,b as r,c,d as a,t as E,e as h,v as W,j as z,q as k,p as u,I as J,S as V,G as y,i as B,f as R}from"./index-1eadb02e.js";const Q=G({name:"UsuarioForm",watch:{},props:{isEdit:{type:Boolean,default:!1}},setup(e){const i=b(e.isEdit),x=j(),v=H(),m=P(),_=b(!1),l=b(!1),o=b({}),s=b({}),C=b(null),d=b(!1),n=B(),N=b(!1),{showToast:g,showSuccessAlert:D,showConfirmAlert:A,showErrorAlert:w,showLoading:U,closeLoading:T}=B(),M=[{nombre:"ADMINISTRADOR",value:"ROLE_ADMIN"},{nombre:"EMPLEADO DE RECURSOS HUMANOS",value:"ROLE_EMPLEADO_HR"},{nombre:"ASISTENTE DE RECURSOS HUMANOS",value:"ROLE_ASISTENTE_HR"},{nombre:"EMPLEADO GENERAL",value:"ROLE_EMPLEADO"}],S=async()=>{C.value=x.params.id,U(),m.getUsuario(C.value).then(()=>{s.value=m.data,_.value=!0,d.value=s.value.locked,N.value=s.value.email==J.get("email"),q(),T()})};$(()=>{i.value&&S()});const q=()=>(_.value=!0,l.value=!0,s.value.nombre==null||s.value.nombre==null||s.value.nombre==""?(o.value.nombre="El nombre es obligatorio",l.value=!1):o.value.nombre="",s.value.apellidos==null||s.value.apellidos==null||s.value.apellidos==""?(o.value.apellidos="Los apellidos son obligatorios",l.value=!1):o.value.apellidos="",s.value.email==null||s.value.email==null||s.value.email==""?(o.value.email="El correo electrónico es obligatorio",l.value=!1):s.value.email.includes("@")?o.value.email="":(o.value.email="El correo electrónico debe ser válido",l.value=!1),s.value.rol==null||s.value.rol==null||s.value.rol==""?(o.value.rol="El rol es obligatorio",l.value=!1):o.value.rol="",l.value);return{data:s,validate:q,submit:()=>{if(q()==!1){g("error","Verifique los campos marcados en rojo");return}let t={...s.value};if(i.value){var f=s.value.id;A("¿Estás seguro?","Se actualizarán los datos del usuario","warning","Sí, actualizar","No, cancelar").then(L=>{L?m.editarUsuario(f,t).then(p=>{console.log(p),p.status==200?D("¡Éxito!","El usuario se ha actualizado correctamente","success","Aceptar").then(()=>{v.push({name:"usuarios"})}):w("Error",p.response.data,"error","Aceptar")}).catch(p=>{g("error","Ocurrió un error al actualizar el usuario")}):g("info","No se actualizaron los datos")})}else A("¿Estás seguro?","Se registrarán los datos del usuario","warning","Sí, registrar","No, cancelar").then(L=>{L?m.registrarUsuario(t).then(p=>{console.log(p),p.status==200?D("¡Registro exitoso!","El usuario recibirá un correo en unos minutos, revise su bandeja de entrada y su bandeja de spam","success","Aceptar").then(()=>{v.push({name:"usuarios"})}):w("Error",p.response.data,"error","Aceptar")}).catch(p=>{g("error","Ocurrió un error al registrar el usuario")}):g("info","No se registraron los datos")})},cancelar:()=>{A("¿Deseas cancelar?","Los cambios no guardados se perderán","question","Sí, cancelar","No, regresar").then(t=>{t&&v.push({name:"usuarios"})})},error:o,validated:_,isEdit:i,eliminar:()=>{V.fire({title:"Se requiere confirmación",text:"Esta acción eliminará al usuario de forma permanente y no se puede revertir, puedes bloquear al usuario en su lugar y reactivarlo cuando lo desees.",icon:"warning",iconColor:"#dc3545",input:"checkbox",inputValue:0,inputPlaceholder:"Entiendo, quiero continuar",confirmButtonText:'Continuar <i class="bi bi-shield-exclamation"></i>',confirmButtonColor:"#dc3545",cancelButtonText:"Cancelar</i>",showCancelButton:!0,inputValidator:t=>!t&&"Debes confirmar que entiendes las consecuencias de esta acción"}).then(t=>{t.value&&(console.log(s.value.id),m.eliminarUsuario(s.value.id).then(f=>{f==200?V.fire({icon:"success",title:"¡Éxito!",text:"El usuario ha sido eliminado de forma permanente"}).then(()=>{v.push({name:"usuarios"})}):w("Error","Ocurrió un error al eliminar el usuario","error","Aceptar")}).catch(f=>{g("error","Ocurrió un error al eliminar el usuario")}))})},roles:M,isLocked:d,lock_unlock:()=>{let t=s.value.id;s.value.locked==!0?(n.showLoading("Desbloqueando usuario"),m.desbloquearUsuario(t).then(()=>{n.closeLoading(),n.showSuccessAlert("Éxito","Usuario desbloqueado"),S()}).catch(f=>{f.code==="ERR_NETWORK"?n.showErrorAlert("Error","No se pudo conectar con el servidor"):n.showErrorAlert("Error","Ocurrió un error inesperado")})):(n.showLoading("Bloqueando usuario"),m.bloquearUsuario(t).then(()=>{n.closeLoading(),n.showSuccessAlert("Éxito","Usuario bloqueado"),S()}).catch(f=>{n.closeLoading(),f.code==="ERR_NETWORK"?n.showErrorAlert("Error","No se pudo conectar con el servidor"):n.showErrorAlert("Error","Ocurrió un error inesperado")}))},editingSelf:N,goBack:()=>v.go(-1)}},components:{InputText:F}}),X={class:"container-lg pt-4 my-3"},Y={class:"card shadow-5 border-round-2xl overflow-hidden"},Z={class:"d-flex relative card-header py-0 pe-0"},ee={class:"flex text-center"},se={key:0,class:"bi bi-person-fill-gear fw-bold h1 my-0"},ae={key:1,class:"bi bi-person-fill-add fw-bold h1 my-0"},oe={class:"fw-bold h4 align-self-center ms-3 my-0"},le={id:"form"},re={class:"card-body"},ie={class:"grid"},ne={class:"col-12"},te={class:"col-12 md:col-offset-3 md:col-6"},ce=a("label",{for:"curp",class:"form-label"},[y("Correo electrónico"),a("b",{class:"p-error"},"*")],-1),de={key:0,class:"p-error"},ue={class:"col-12 md:col-offset-3 md:col-6"},pe=a("label",{for:"nombre",class:"form-label"},[y("Nombre(s)"),a("b",{class:"p-error"},"*")],-1),me={key:0,class:"p-error"},fe={class:"col-12 md:col-offset-3 md:col-6"},be=a("label",{for:"rfc",class:"form-label"},[y("Apellidos"),a("b",{class:"p-error"},"*")],-1),he={key:0,class:"p-error"},ve={class:"col-12 md:col-offset-3 md:col-6"},ge=a("label",{for:"genero",class:"form-label"},[y("Rol"),a("b",{class:"text-danger"},"*")],-1),ke={key:0,class:"p-error"},Ee={key:0,class:"col-12"},ye=R('<strong class="text-color">Permisos del rol:</strong><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de empleados (incluyendo historial)</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de plazas</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de departamentos</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Realizar consultas avanzadas y exportar los resultados</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Generar y exportar reportes</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Acceder al dashboard</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Registrar, eliminar, bloquear y desbloquear usuarios</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Generar y descargar respaldos de la Base de datos</span>',9),_e=[ye],Ce={key:1,class:"col-12"},Re=R('<strong class="text-color">Permisos del rol:</strong><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de empleados (incluyendo historial)</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de plazas</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de departamentos</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Realizar consultas avanzadas y exportar los resultados</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Generar y exportar reportes</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Acceder al dashboard</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Registrar, eliminar, bloquear y desbloquear usuarios</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Generar y descargar respaldos de la Base de datos</span>',9),Ae=[Re],we={key:2,class:"col-12"},Se=R('<strong class="text-color">Permisos del rol:</strong><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de empleados (incluyendo historial)</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de plazas</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de departamentos</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Realizar consultas avanzadas y exportar los resultados</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Generar y exportar reportes</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Acceder al dashboard</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Registrar, eliminar, bloquear y desbloquear usuarios</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Generar y descargar respaldos de la Base de datos</span>',9),qe=[Se],Le={key:3,class:"col-12"},Oe=R('<strong class="text-color">Permisos del rol:</strong><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar su propia información (inf. personal, plazas y expediente)</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Consultar y modificar información de plazas</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Consultar y modificar información de departamentos</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Realizar consultas avanzadas y exportar los resultados</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Generar y exportar reportes</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Acceder al dashboard</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Registrar, eliminar, bloquear y desbloquear usuarios</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Generar y descargar respaldos de la Base de datos</span>',9),xe=[Oe],Ne=a("small",null,[a("b",{class:"text-danger"},"*"),y(" Campos obligatorios")],-1),De={class:"card-footer d-flex"};function ze(e,i,x,v,m,_){const l=O("Button"),o=O("InputText"),s=O("Dropdown"),C=K("tooltip");return r(),c("div",X,[a("div",Y,[a("div",Z,[a("span",ee,[e.isEdit?(r(),c("i",se)):(r(),c("i",ae)),a("span",oe,E(e.isEdit?" Editar":"Registrar")+" Usuario ",1)]),h(l,{icon:"pi pi-times",severity:"danger",size:"small",onClick:e.goBack,class:"ms-auto border-noround float-end hover:bg-red-500 hover:text-white",text:"",style:{height:"48px"}},null,8,["onClick"])]),a("form",le,[a("div",re,[a("div",ie,[a("div",ne,[e.isEdit?W((r(),z(l,{key:0,icon:e.data.locked?"pi pi-lock-open":"pi pi-lock",class:k(["float-end border-none me-2",e.editingSelf==!0?"bg-gray-700 border-none":e.data.locked?"bg-green-700":"bg-red-700"]),onClick:e.lock_unlock,label:e.data.locked?"Desbloquear":"Bloquear",disabled:e.editingSelf==!0},null,8,["icon","onClick","label","class","disabled"])),[[C,e.data.locked?"Desbloquear al usuario permitirá que pueda iniciar sesión en el sistema":"Bloquear al usuario evitará que pueda iniciar sesión en el sistema, pero no eliminará sus datos",void 0,{top:!0}]]):u("",!0)]),a("div",te,[ce,h(o,{modelValue:e.data.email,"onUpdate:modelValue":i[0]||(i[0]=d=>e.data.email=d),autocomplete:"none",placeholder:"Direccion de correo electrónico",class:k(["w-full",{"p-invalid":e.error.email&&e.validated}]),disabled:e.isEdit},null,8,["modelValue","class","disabled"]),e.validated?(r(),c("small",de,E(e.error.email||""),1)):u("",!0)]),a("div",ue,[pe,h(o,{modelValue:e.data.nombre,"onUpdate:modelValue":i[1]||(i[1]=d=>e.data.nombre=d),placeholder:"Nombre de la persona, ej: Juan",class:k(["w-full",{"p-invalid":e.error.nombre&&e.validated}]),id:"nombre"},null,8,["modelValue","class"]),e.validated?(r(),c("small",me,E(e.error.nombre||""),1)):u("",!0)]),a("div",fe,[be,h(o,{modelValue:e.data.apellidos,"onUpdate:modelValue":i[2]||(i[2]=d=>e.data.apellidos=d),placeholder:"Apellidos de la persona, ej: Perez Lopez",class:k(["w-full",{"p-invalid":e.error.apellidos&&e.validated}])},null,8,["modelValue","class"]),e.validated?(r(),c("small",he,E(e.error.apellidos||""),1)):u("",!0)]),a("div",ve,[ge,h(s,{modelValue:e.data.rol,"onUpdate:modelValue":i[3]||(i[3]=d=>e.data.rol=d),options:e.roles,optionLabel:"nombre",optionValue:"value",placeholder:"Elija el rol cuidadosamente",class:k(["w-full",{"p-invalid":e.error.rol&&e.validated}]),showClear:"",disabled:e.editingSelf},null,8,["modelValue","options","class","disabled"]),e.validated?(r(),c("small",ke,E(e.error.rol||""),1)):u("",!0)]),e.data.rol=="ROLE_ADMIN"?(r(),c("div",Ee,_e)):u("",!0),e.data.rol=="ROLE_EMPLEADO_HR"?(r(),c("div",Ce,Ae)):u("",!0),e.data.rol=="ROLE_ASISTENTE_HR"?(r(),c("div",we,qe)):u("",!0),e.data.rol=="ROLE_EMPLEADO"?(r(),c("div",Le,xe)):u("",!0)]),Ne]),a("div",De,[e.isEdit?(r(),z(l,{key:0,icon:"pi pi-trash",class:k(["me-2",e.editingSelf==!0?"bg-gray-700 border-none":"bg-red-700"]),label:"Eliminar",onClick:e.eliminar,severity:"danger",disabled:e.editingSelf==!0},null,8,["onClick","disabled","class"])):u("",!0),h(l,{icon:"pi pi-check",id:"submitButton",class:"me-2 ms-auto",label:"Guardar",onClick:e.submit},null,8,["onClick"]),h(l,{icon:"pi pi-times",class:"ms-2 float-end",severity:"secondary",label:"Cancelar",onClick:e.cancelar},null,8,["onClick"])])])])])}const Ge=I(Q,[["render",ze]]);export{Ge as E};
