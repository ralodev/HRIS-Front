import{_ as T,P as y,D as m,g as R,a as f,b as q,c as B,d as n,e as u,h as C,r as _,I as v,u as N,o as D,s as S,n as U,i as I}from"./index-6fc40b30.js";import{u as V}from"./adminStore-40a37f1b.js";y.use(m,m,m,m);const K=R({name:"TablaEmpleados",components:{DataTable:y},setup(){const a=_("");v.get("email");let r;const h=_(),l=V(),s=I(),p=N(),i=_([]),c={responsive:!0,autoWidth:!0,dom:"trip",paging:!0,pagingType:"numbers",language:S,pageLength:10,order:[[0,"asc"]],initComplete:function(){this.on("draw.dt",function(){U(()=>{w(),r.responsive.recalc()})})}},b=[{data:null,title:"Nombre",class:"all",width:"20%",render:function(e){let o;return e.estado=="ACTIVO"?o="<span class='float-end p-tag p-component p-tag-success' title='Este usuario está habilitado' style='cursor: help !important;'>H<span class='d-lg-block d-none'>abilitado</span></span>":e.estado=="BLOQUEADO"?o="<span class='float-end p-tag p-component p-tag-danger' title='Este usuario se encuentra bloqueado' style='cursor: help !important;'>B<span class='d-lg-block d-none'>loqueado</span></span>":o="<span class='float-end p-tag p-component p-tag-warning' title='Este usuario no ha confirmado su correo electrónico' style='cursor: help !important;'>P<span class='d-lg-block d-none'>endiente</span>",e.nombre+" "+e.apellidos+" "+o}},{data:"rol",title:"Rol",width:"10%",class:"min-tablet-l",render:function(e){let o=e=="ROLE_ADMIN"?1:e=="ROLE_EMPLEADO_HR"?2:e=="ROLE_PLANEACION"?3:e=="ROLE_ASISTENTE_HR"?4:5,g=e.replaceAll("_"," ").replaceAll("ROLE","");return"<span class='d-none'>"+o+"</span>"+g}},{data:"email",title:"Correo electrónico",class:"min-tablet-l no-wrap text-nowrap email-col",width:"10%"},{data:null,class:"text-nowrap  acciones justify-content-center all ",width:"10%",title:"Acciones",orderable:!1,wrap:!0,render:function(e){let o="<a title='Ver empleado' name='"+e.id+"' class='details-btn me-1 px-3 p-button-sm p-button p-component p-button-icon-only p-button-primary p-button-raised text-decoration-none'><i class='pi pi-user-edit'></i></a> ";return e.estado=="BLOQUEADO"?o+="<a title='Desbloquear' name='"+e.id+"' class='unlock-btn px-3 p-button-sm p-button p-component p-button-icon-only p-button-success bg-green-600 p-button-raised text-decoration-none'><i class='pi pi-lock-open'></i></a>":o+="<a title='Bloquear' name='"+e.id+"' class='lock-btn px-3 p-button-sm p-button p-component p-button-icon-only p-button-danger p-button-raised text-decoration-none'><i class='pi pi-lock'></i></a>",o}},{data:"estado",title:"Estado",class:"never"}],d=async()=>{var e=!1;s.showLoading("Cargando datos"),setTimeout(()=>{e||(s.closeLoading(),s.showErrorAlert("Error","Ocurrió un error inesperado"))},5e3),await l.getUsuarios().then(()=>{i.value=l.data,i.value.forEach(o=>{o.locked==!0?o.estado="BLOQUEADO":o.enabled==!1?o.estado="INACTIVO":o.estado="ACTIVO"}),s.closeLoading(),e=!0}).catch(o=>{o.code==="ERR_NETWORK"?s.showErrorAlert("Error","No se pudo conectar con el servidor"):s.showErrorAlert("Error","Ocurrió un error inesperado"),e=!0})},w=()=>{const e=document.querySelectorAll(".details-btn"),o=document.querySelectorAll(".lock-btn"),g=document.querySelectorAll(".unlock-btn"),x=document.querySelectorAll(".email-col"),O=v.get("email");e.forEach(t=>{t.parentElement.classList.add("flex"),t.addEventListener("click",()=>{p.push({name:"usuarios_editar",params:{id:t.attributes.name.value}})})}),o.forEach(t=>{t.parentElement.classList.add("flex"),t.addEventListener("click",()=>{A(t.attributes.name.value)})}),g.forEach(t=>{t.parentElement.classList.add("flex"),t.addEventListener("click",()=>{k(t.attributes.name.value)})}),x.forEach(t=>{if(t.innerText==O){t.closest("tr").children[3].title="No puedes bloquear tu propio usuario";let E=t.closest("tr").children[3].children[0];E.nextElementSibling.classList.add("p-disabled"),E.nextElementSibling.classList.add("p-button-secondary"),E.nextElementSibling.classList.remove("p-button-danger")}})},L=()=>{r.search(a.value).draw()};D(()=>{d(),r=h.value.dt});const A=e=>{s.showLoading("Bloqueando usuario"),setTimeout(()=>{s.closeLoading()},5e3),l.bloquearUsuario(e).then(()=>{s.closeLoading(),s.showSuccessAlert("Éxito","Usuario bloqueado"),d()}).catch(o=>{s.closeLoading(),o.code==="ERR_NETWORK"?s.showErrorAlert("Error","No se pudo conectar con el servidor"):s.showErrorAlert("Error","Ocurrió un error inesperado")})},k=e=>{s.showLoading("Desbloqueando usuario"),l.desbloquearUsuario(e).then(()=>{s.closeLoading(),s.showSuccessAlert("Éxito","Usuario desbloqueado"),d()}).catch(o=>{o.code==="ERR_NETWORK"?s.showErrorAlert("Error","No se pudo conectar con el servidor"):s.showErrorAlert("Error","Ocurrió un error inesperado")})};return{columns:b,data:i,options:c,registrar:()=>{p.push({name:"usuarios_registrar"})},historial:()=>{p.push({name:"usuarios_historial"})},search:L,searchText:a,table:h}}}),H={class:"container-lg pt-4 my-3"},P={class:"card shadow-5 border-round-2xl overflow-hidden"},W=n("div",{class:"d-flex card-header py-0 pe-0"},[n("span",{class:"flex text-center"},[n("i",{class:"bi bi-person-vcard-fill fw-bold h1 my-0"}),n("span",{class:"fw-bold h4 align-self-center ms-3 my-0"}," Usuarios registrados ")])],-1),$={class:"card-body table-responsive"},M={class:"grid mb-2"},Q={class:"col-12 lg:col-6 md:col-6"},j={class:"p-inputgroup"},z={class:"col-12 lg:col-6 md:col-6"};function F(a,r,h,l,s,p){const i=f("InputText"),c=f("Button"),b=f("DataTable");return q(),B("div",H,[n("div",P,[W,n("div",$,[n("div",M,[n("div",Q,[n("div",j,[u(i,{placeholder:"Buscar usuario",id:"searchInput",onKeyup:C(a.search,["enter"]),modelValue:a.searchText,"onUpdate:modelValue":r[0]||(r[0]=d=>a.searchText=d),type:"search",autocomplete:"none"},null,8,["onKeyup","modelValue"]),u(c,{icon:"pi pi-search",severity:"primary",onClick:a.search},null,8,["onClick"])])]),n("div",z,[u(c,{type:"button",label:"Registrar usuario",icon:"pi pi-user-plus",onClick:a.registrar,class:"float-end",raised:""},null,8,["onClick"]),u(c,{type:"button",label:"Historial",icon:"pi pi-history",onClick:a.historial,class:"float-end me-2",severity:"secondary",raised:""},null,8,["onClick"])])]),u(b,{columns:a.columns,data:a.data,class:"table-responsive text-nowrap hover row-border border order-column",width:"100%",options:a.options,ref:"table"},null,8,["columns","data","options"])])])])}const X=T(K,[["render",F]]);export{X as default};
