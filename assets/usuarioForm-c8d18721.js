import{u as M}from"./adminStore-d15fddf2.js";import{g as P,_ as G,r as b,k as I,u as j,o as H,l as $,a as S,m as F,b as r,c,d as a,t as g,e as h,v as K,j as D,q as E,p as u,S as z,G as _,i as V,f as R}from"./index-e51a670a.js";const W=P({name:"UsuarioForm",watch:{},props:{isEdit:{type:Boolean,default:!1}},setup(e){const i=b(e.isEdit),N=I(),v=j(),m=M(),y=b(!1),l=b(!1),o=b({}),s=b({}),C=b(null),d=b(!1),n=V(),{showToast:k,showSuccessAlert:q,showConfirmAlert:A,showErrorAlert:w,showLoading:B,closeLoading:U}=V(),T=[{nombre:"ADMINISTRADOR",value:"ROLE_ADMIN"},{nombre:"EMPLEADO DE RECURSOS HUMANOS",value:"ROLE_EMPLEADO_HR"},{nombre:"ASISTENTE DE RECURSOS HUMANOS",value:"ROLE_ASISTENTE_HR"},{nombre:"EMPLEADO GENERAL",value:"ROLE_EMPLEADO"}],x=async()=>{C.value=N.params.id,B(),m.getUsuario(C.value).then(()=>{s.value=m.data,y.value=!0,d.value=s.value.locked,L(),U()})};H(()=>{i.value&&x()});const L=()=>{if(y.value=!0,l.value=!0,s.value.nombre==null||s.value.nombre==null||s.value.nombre==""?(o.value.nombre="El nombre es obligatorio",l.value=!1):o.value.nombre="",s.value.apellidos==null||s.value.apellidos==null||s.value.apellidos==""?(o.value.apellidos="Los apellidos son obligatorios",l.value=!1):o.value.apellidos="",s.value.email==null||s.value.email==null||s.value.email==""?(o.value.email="El correo electrónico es obligatorio",l.value=!1):s.value.email.includes("@")?o.value.email="":(o.value.email="El correo electrónico debe ser válido",l.value=!1),s.value.rol==null||s.value.rol==null||s.value.rol==""?(o.value.rol="El rol es obligatorio",l.value=!1):o.value.rol="",!l.value){k("error","Verifique los campos marcados en rojo");return}};return{data:s,validate:L,submit:()=>{L();let t={...s.value};if(i.value){var f=s.value.id;A("¿Estás seguro?","Se actualizarán los datos del usuario","warning","Sí, actualizar","No, cancelar").then(O=>{O?m.editarUsuario(f,t).then(p=>{console.log(p),p.status==200?q("¡Éxito!","El usuario se ha actualizado correctamente","success","Aceptar").then(()=>{v.push({name:"usuarios"})}):w("Error",p.response.data,"error","Aceptar")}).catch(p=>{k("error","Ocurrió un error al actualizar el usuario")}):k("info","No se actualizaron los datos")})}else A("¿Estás seguro?","Se registrarán los datos del usuario","warning","Sí, registrar","No, cancelar").then(O=>{O?m.registrarUsuario(t).then(p=>{console.log(p),p.status==200?q("¡Registro exitoso!","El usuario recibirá un correo en unos minutos, revise su bandeja de entrada y su bandeja de spam","success","Aceptar").then(()=>{v.push({name:"usuarios"})}):w("Error",p.response.data,"error","Aceptar")}).catch(p=>{k("error","Ocurrió un error al registrar el usuario")}):k("info","No se registraron los datos")})},cancelar:()=>{A("¿Deseas cancelar?","Los cambios no guardados se perderán","question","Sí, cancelar","No, regresar").then(t=>{t&&v.push({name:"usuarios"})})},error:o,validated:y,isEdit:i,eliminar:()=>{z.fire({title:"Se requiere confirmación",text:"Esta acción eliminará al usuario de forma permanente y no se puede revertir, puedes bloquear al usuario en su lugar y reactivarlo cuando lo desees.",icon:"warning",iconColor:"#dc3545",input:"checkbox",inputValue:0,inputPlaceholder:"Entiendo, quiero continuar",confirmButtonText:'Continuar <i class="bi bi-shield-exclamation"></i>',confirmButtonColor:"#dc3545",cancelButtonText:"Cancelar</i>",showCancelButton:!0,inputValidator:t=>!t&&"Debes confirmar que entiendes las consecuencias de esta acción"}).then(t=>{t.value&&(console.log(s.value.id),m.eliminarUsuario(s.value.id).then(f=>{f==200?z.fire({icon:"success",title:"¡Éxito!",text:"El usuario ha sido eliminado de forma permanente"}).then(()=>{v.push({name:"usuarios"})}):w("Error","Ocurrió un error al eliminar el usuario","error","Aceptar")}).catch(f=>{k("error","Ocurrió un error al eliminar el usuario")}))})},roles:T,isLocked:d,lock_unlock:()=>{let t=s.value.id;s.value.locked==!0?(n.showLoading("Desbloqueando usuario"),m.desbloquearUsuario(t).then(()=>{n.closeLoading(),n.showSuccessAlert("Éxito","Usuario desbloqueado"),x()}).catch(f=>{f.code==="ERR_NETWORK"?n.showErrorAlert("Error","No se pudo conectar con el servidor"):n.showErrorAlert("Error","Ocurrió un error inesperado")})):(n.showLoading("Bloqueando usuario"),m.bloquearUsuario(t).then(()=>{n.closeLoading(),n.showSuccessAlert("Éxito","Usuario bloqueado"),x()}).catch(f=>{n.closeLoading(),f.code==="ERR_NETWORK"?n.showErrorAlert("Error","No se pudo conectar con el servidor"):n.showErrorAlert("Error","Ocurrió un error inesperado")}))},goBack:()=>v.go(-1)}},components:{InputText:$}}),J={class:"container-lg pt-4 my-3"},Q={class:"card shadow-5 border-round-2xl overflow-hidden"},X={class:"d-flex relative card-header py-0 pe-0"},Y={class:"flex text-center"},Z={key:0,class:"bi bi-person-fill-gear fw-bold h1 my-0"},ee={key:1,class:"bi bi-person-fill-add fw-bold h1 my-0"},se={class:"fw-bold h4 align-self-center ms-3 my-0"},ae={id:"form"},oe={class:"card-body"},le={class:"grid"},re={class:"col-12"},ie={class:"col-12 md:col-offset-3 md:col-6"},ne=a("label",{for:"curp",class:"form-label"},[_("Correo electrónico"),a("b",{class:"p-error"},"*")],-1),te={key:0,class:"p-error"},ce={class:"col-12 md:col-offset-3 md:col-6"},de=a("label",{for:"nombre",class:"form-label"},[_("Nombre(s)"),a("b",{class:"p-error"},"*")],-1),ue={key:0,class:"p-error"},pe={class:"col-12 md:col-offset-3 md:col-6"},me=a("label",{for:"rfc",class:"form-label"},[_("Apellidos"),a("b",{class:"p-error"},"*")],-1),fe={key:0,class:"p-error"},be={class:"col-12 md:col-offset-3 md:col-6"},he=a("label",{for:"genero",class:"form-label"},[_("Rol"),a("b",{class:"text-danger"},"*")],-1),ve={key:0,class:"p-error"},ke={key:0,class:"col-12"},ge=R('<strong class="text-color">Permisos del rol:</strong><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de empleados (incluyendo historial)</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de plazas</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de departamentos</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Realizar consultas avanzadas y exportar los resultados</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Generar y exportar reportes</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Acceder al dashboard</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Registrar, eliminar, bloquear y desbloquear usuarios</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Generar y descargar respaldos de la Base de datos</span>',9),Ee=[ge],_e={key:1,class:"col-12"},ye=R('<strong class="text-color">Permisos del rol:</strong><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de empleados (incluyendo historial)</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de plazas</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de departamentos</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Realizar consultas avanzadas y exportar los resultados</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Generar y exportar reportes</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Acceder al dashboard</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Registrar, eliminar, bloquear y desbloquear usuarios</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Generar y descargar respaldos de la Base de datos</span>',9),Ce=[ye],Re={key:2,class:"col-12"},Ae=R('<strong class="text-color">Permisos del rol:</strong><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de empleados (incluyendo historial)</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de plazas</span><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar y modificar información de departamentos</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Realizar consultas avanzadas y exportar los resultados</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Generar y exportar reportes</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Acceder al dashboard</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Registrar, eliminar, bloquear y desbloquear usuarios</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Generar y descargar respaldos de la Base de datos</span>',9),we=[Ae],xe={key:3,class:"col-12"},Le=R('<strong class="text-color">Permisos del rol:</strong><span class="block text-green-700 font-medium"><i class="pi pi-check-circle"></i> Consultar su propia información (inf. personal, plazas y expediente)</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Consultar y modificar información de plazas</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Consultar y modificar información de departamentos</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Realizar consultas avanzadas y exportar los resultados</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Generar y exportar reportes</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Acceder al dashboard</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Registrar, eliminar, bloquear y desbloquear usuarios</span><span class="block text-red-700 font-medium"><i class="pi pi-times-circle"></i> Generar y descargar respaldos de la Base de datos</span>',9),Oe=[Le],Se=a("small",null,[a("b",{class:"text-danger"},"*"),_(" Campos obligatorios")],-1),Ne={class:"card-footer d-flex"};function qe(e,i,N,v,m,y){const l=S("Button"),o=S("InputText"),s=S("Dropdown"),C=F("tooltip");return r(),c("div",J,[a("div",Q,[a("div",X,[a("span",Y,[e.isEdit?(r(),c("i",Z)):(r(),c("i",ee)),a("span",se,g(e.isEdit?" Editar":"Registrar")+" Usuario ",1)]),h(l,{icon:"pi pi-times",severity:"danger",size:"small",onClick:e.goBack,class:"ms-auto border-noround float-end hover:bg-red-500 hover:text-white",text:"",style:{height:"48px"}},null,8,["onClick"])]),a("form",ae,[a("div",oe,[a("div",le,[a("div",re,[e.isEdit?K((r(),D(l,{key:0,icon:e.data.locked?"pi pi-lock-open":"pi pi-lock",class:E(["float-end border-none me-2",e.data.locked?"bg-green-700":"bg-red-700"]),onClick:e.lock_unlock,label:e.data.locked?"Desbloquear":"Bloquear"},null,8,["icon","onClick","label","class"])),[[C,"Un usuario bloqueado no puede acceder a la plataforma ni a sus funciones",void 0,{top:!0}]]):u("",!0)]),a("div",ie,[ne,h(o,{modelValue:e.data.email,"onUpdate:modelValue":i[0]||(i[0]=d=>e.data.email=d),autocomplete:"none",placeholder:"Direccion de correo electrónico",class:E(["w-full",{"p-invalid":e.error.email&&e.validated}])},null,8,["modelValue","class"]),e.validated?(r(),c("small",te,g(e.error.email||""),1)):u("",!0)]),a("div",ce,[de,h(o,{modelValue:e.data.nombre,"onUpdate:modelValue":i[1]||(i[1]=d=>e.data.nombre=d),placeholder:"Nombre de la persona, ej: Juan",class:E(["w-full",{"p-invalid":e.error.nombre&&e.validated}]),id:"nombre"},null,8,["modelValue","class"]),e.validated?(r(),c("small",ue,g(e.error.nombre||""),1)):u("",!0)]),a("div",pe,[me,h(o,{modelValue:e.data.apellidos,"onUpdate:modelValue":i[2]||(i[2]=d=>e.data.apellidos=d),placeholder:"Apellidos de la persona, ej: Perez Lopez",class:E(["w-full",{"p-invalid":e.error.apellidos&&e.validated}])},null,8,["modelValue","class"]),e.validated?(r(),c("small",fe,g(e.error.apellidos||""),1)):u("",!0)]),a("div",be,[he,h(s,{modelValue:e.data.rol,"onUpdate:modelValue":i[3]||(i[3]=d=>e.data.rol=d),options:e.roles,optionLabel:"nombre",optionValue:"value",placeholder:"Elija el rol cuidadosamente",class:E(["w-full",{"p-invalid":e.error.rol&&e.validated}]),showClear:""},null,8,["modelValue","options","class"]),e.validated?(r(),c("small",ve,g(e.error.rol||""),1)):u("",!0)]),e.data.rol=="ROLE_ADMIN"?(r(),c("div",ke,Ee)):u("",!0),e.data.rol=="ROLE_EMPLEADO_HR"?(r(),c("div",_e,Ce)):u("",!0),e.data.rol=="ROLE_ASISTENTE_HR"?(r(),c("div",Re,we)):u("",!0),e.data.rol=="ROLE_EMPLEADO"?(r(),c("div",xe,Oe)):u("",!0)]),Se]),a("div",Ne,[e.isEdit?(r(),D(l,{key:0,icon:"pi pi-trash",class:"me-2",label:"Eliminar",onClick:e.eliminar,severity:"danger"},null,8,["onClick"])):u("",!0),h(l,{icon:"pi pi-check",id:"submitButton",class:"me-2 ms-auto",label:"Guardar",onClick:e.submit},null,8,["onClick"]),h(l,{icon:"pi pi-times",class:"ms-2 float-end",severity:"secondary",label:"Cancelar",onClick:e.cancelar},null,8,["onClick"])])])])])}const Me=G(W,[["render",qe]]);export{Me as E};
